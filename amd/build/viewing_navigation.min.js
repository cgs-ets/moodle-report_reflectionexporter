/**
 * Javascript to handle changing users via the user selector in the header.
 *
 * @module     report_reflectionexporter/grading_navigation
 * @copyright  2016 Damyon Wiese <damyon@moodle.com>
 * @copyright  2022 Veronica Bermegui
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_reflectionexporter/viewing_navigation",["jquery","core/notification","core/str","core/ajax"],(function($,notification,str,ajax){var viewingNavigation=function(selector){this._regionSelector=selector,this._region=$(selector),this._filters=[],this._users=[],this._firstLoadUsers=!0,this._loadAllUsers(),this._region.find('[data-action="previous-user"]').on("click",this._handlePreviousUser.bind(this)),this._region.find('[data-action="next-user"]').on("click",this._handleNextUser.bind(this)),this._region.find('[data-action="change-user"]').on("change",this._handleChangeUser.bind(this)),$(document).on("user-changed",this._refreshSelector.bind(this)),$(document).bind("start-loading-user",function(){this._isLoading=!0}.bind(this)),$(document).bind("finish-loading-user",function(){this._isLoading=!1}.bind(this))};return viewingNavigation.prototype._isLoading=!1,viewingNavigation.prototype._regionSelector=null,viewingNavigation.prototype._filters=null,viewingNavigation.prototype._users=null,viewingNavigation.prototype._region=null,viewingNavigation.prototype._lastFilters="",viewingNavigation.prototype._loadAllUsers=function(){var reflecid=this._region.find("[data-action=change-user]").attr("data-rid");return ajax.call([{methodname:"report_reflectionexporter_list_participants",args:{rid:reflecid},done:this._usersLoaded.bind(this),fail:notification.exception}]),!0},viewingNavigation.prototype._usersLoaded=function(users){this._firstLoadUsers=!1,this._users=users;for(var select=this._region.find("[data-action=change-user]")[0],i=0;i<this._users.length;i++){var option=document.createElement("option");option.value=this._users[i].id,option.text=this._users[i].fullname,select.add(option)}var firstUser=this._users[0].id;$('[data-region="viewer-navigation-panel"]').attr("data-first-userid",firstUser),$('[data-region="viewer-navigation-panel"]').attr("first-userid",firstUser),this._selectUserById(firstUser)},viewingNavigation.prototype._selectUserById=function(userid){var select=this._region.find("[data-action=change-user]"),useridnumber=parseInt(userid,10);select.attr("data-selected",userid),!isNaN(useridnumber)&&useridnumber>0&&$(document).trigger("user-changed",userid)},viewingNavigation.prototype._handlePreviousUser=function(e){e.preventDefault();var currentUserId=this._region.find("[data-action=change-user]").attr("data-selected"),i=0,currentIndex=0;for(i=0;i<this._users.length;i++)if(this._users[i].id==currentUserId){currentIndex=i;break}var count=this._users.length,newIndex=currentIndex-1;newIndex<0&&(newIndex=count-1),count&&this._selectUserById(this._users[newIndex].id,newIndex)},viewingNavigation.prototype._handleNextUser=function(e,saved){e.preventDefault();var currentUserId=this._region.find("[data-action=change-user]").attr("data-selected"),i=0,currentIndex=0;for(i=0;i<this._users.length;i++)if(this._users[i].id==currentUserId){currentIndex=i;break}var count=this._users.length,newIndex=(currentIndex+1)%count;count&&this._selectUserById(this._users[newIndex].id)},viewingNavigation.prototype._refreshSelector=function(event,userid){var select=this._region.find("[data-action=change-user]");userid=parseInt(userid,10);select=this._region.find("[data-action=change-user]");userid=parseInt(userid,10),!isNaN(userid)&&userid>0&&select.attr("data-selected",userid);for(var i=0,options=document.querySelector("[data-action=change-user]").children;i<options.length;i++)options[i].getAttribute("value")==String(userid)?options[i].setAttribute("selected",!0):options[i].getAttribute("selected")&&options[i].removeAttribute("selected")},viewingNavigation.prototype._handleChangeUser=function(){Y.log("_handleChangeUser...");var select=this._region.find("[data-action=change-user]"),userid=parseInt(select.val(),10);this._isLoading||!isNaN(userid)&&userid>0&&(select.attr("data-selected",userid),$(document).trigger("user-changed",userid))},viewingNavigation}));

//# sourceMappingURL=viewing_navigation.min.js.map