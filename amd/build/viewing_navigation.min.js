define ("report_reflectionexporter/viewing_navigation",["jquery","core/notification","core/str","core/ajax"],function(a,b,c,d){var e=function(b){this._regionSelector=b;this._region=a(b);this._filters=[];this._users=[];this._firstLoadUsers=!0;this._loadAllUsers();this._region.find("[data-action=\"previous-user\"]").on("click",this._handlePreviousUser.bind(this));this._region.find("[data-action=\"next-user\"]").on("click",this._handleNextUser.bind(this));this._region.find("[data-action=\"change-user\"]").on("change",this._handleChangeUser.bind(this));a(document).on("user-changed",this._refreshSelector.bind(this));a(document).bind("start-loading-user",function(){this._isLoading=!0}.bind(this));a(document).bind("finish-loading-user",function(){this._isLoading=!1}.bind(this))};e.prototype._isLoading=!1;e.prototype._regionSelector=null;e.prototype._filters=null;e.prototype._users=null;e.prototype._region=null;e.prototype._lastFilters="";e.prototype._loadAllUsers=function(){var a=this._region.find("[data-action=change-user]"),c=a.attr("data-rid");d.call([{methodname:"report_reflectionexporter_list_participants",args:{rid:c},done:this._usersLoaded.bind(this),fail:b.exception}]);return!0};e.prototype._usersLoaded=function(b){this._firstLoadUsers=!1;this._users=b;for(var c=this._region.find("[data-action=change-user]")[0],d=0,e;d<this._users.length;d++){e=document.createElement("option");e.value=this._users[d].id;e.text=this._users[d].fullname;c.add(e)}var f=this._users[0].id;a("[data-region=\"viewer-navigation-panel\"]").attr("data-first-userid",f);a("[data-region=\"viewer-navigation-panel\"]").attr("first-userid",f);this._selectUserById(f)};e.prototype._selectUserById=function(b){var c=this._region.find("[data-action=change-user]"),d=parseInt(b,10);c.attr("data-selected",b);if(!isNaN(d)&&0<d){a(document).trigger("user-changed",b)}};e.prototype._handlePreviousUser=function(a){a.preventDefault();var b=this._region.find("[data-action=change-user]"),c=b.attr("data-selected"),d=0,e=0;for(d=0;d<this._users.length;d++){if(this._users[d].id==c){e=d;break}}var f=this._users.length,g=e-1;if(0>g){g=f-1}if(f){this._selectUserById(this._users[g].id,g)}};e.prototype._handleNextUser=function(a){a.preventDefault();var b=this._region.find("[data-action=change-user]"),c=b.attr("data-selected"),d=0,e=0;for(d=0;d<this._users.length;d++){if(this._users[d].id==c){e=d;break}}var f=this._users.length,g=(e+1)%f;if(f){this._selectUserById(this._users[g].id)}};e.prototype._refreshSelector=function(a,b){var c=this._region.find("[data-action=change-user]");b=parseInt(b,10);var c=this._region.find("[data-action=change-user]");b=parseInt(b,10);if(!isNaN(b)&&0<b){c.attr("data-selected",b)}var d=0,e=document.querySelector("[data-action=change-user]").children;for(d;d<e.length;d++){if(e[d].getAttribute("value")==b+""){e[d].setAttribute("selected",!0)}else if(e[d].getAttribute("selected")){e[d].removeAttribute("selected")}}};e.prototype._handleChangeUser=function(){Y.log("_handleChangeUser...");var b=this._region.find("[data-action=change-user]"),c=parseInt(b.val(),10);if(this._isLoading){return}if(!isNaN(c)&&0<c){b.attr("data-selected",c);a(document).trigger("user-changed",c)}};return e});
//# sourceMappingURL=viewing_navigation.min.js.map
