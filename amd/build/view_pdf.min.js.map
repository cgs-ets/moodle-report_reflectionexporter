{"version":3,"file":"view_pdf.min.js","sources":["../src/view_pdf.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle the PDF view\n *\n * @module     report_reflectionexporter/vew_pdf\n * @copyright  2022 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    \"report_reflectionexporter/pdf\",\n    \"report_reflectionexporter/pdf-lib\",\n    \"report_reflectionexporter/reflectionexporterHelper\",\n    'core/templates',\n    'core/ajax',\n    'core/url'\n], function (PDFJSLIB, PDFLib, ReHelper ,Templates, Ajax, url) {\n    \"use strict\";\n\n    var ViewPDF = function () {\n        $(document).on('user-changed', this._init.bind(this));\n    }\n\n    ViewPDF.prototype._init = function () {\n        var self = this;\n\n        Templates.render('report_reflectionexporter/loading', {}).done(function (html, js) {\n            // Update the page.\n            $('[data-region=\"pdf-comment-container\"]').fadeOut(\"fast\", function () {\n                Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\n                $('[data-region=\"pdf-comment-container\"]').fadeIn(\"fast\");\n\n            }.bind(this));\n\n            const user = self._getUser();\n\n            // Call the service that returns the PDF.\n            Ajax.call([{\n                methodname: \"report_reflectionexporter_get_pdfbase64\",\n                args: {\n                    recorid: user[0].id, // This is the id of the record that  in mdl_report_reflec_exporter_pdf\n                },\n                done: function (response) {\n\n                    // Render the pdf container\n                    const downloadurl = new URL(window.location.href);\n                    const exporturl = new URL(window.location.href);\n                    let istkform = false;\n                    let title = 'This form has been completed';\n\n                    self.pdfData = response.pdfbase64;\n                    downloadurl.searchParams.append('d', 1);\n                    self.completed = user[0].status == 'C' ? true : false;\n\n\n                    if (ReHelper.get_ibform_name() === 'TK_PPF') {\n                        istkform = true;\n                        exporturl.searchParams.append('export', 1);\n                    }\n                    console.log(ReHelper.get_ibform_name());\n                    console.log(exporturl);\n\n                    const context = {\n                        courseurl: document.getElementById(\"courseurl\").getAttribute('href'),\n                        downloadaction: downloadurl,\n                        datajson: document.querySelector('.data-pdfjson').getAttribute('data-pdfs'),\n                        completed: user[0].status == 'C' ? true : false,\n                        tkform: istkform,\n                        exportspreadhseetaction: exporturl,\n                        summaryicon: url.imageUrl('clipboard', 'report_reflectionexporter'),\n                        zipicon: url.imageUrl('zip', 'report_reflectionexporter'),\n                        exporticon: url.imageUrl('spreadsheet', 'report_reflectionexporter'),\n                        rid: document.querySelector('[data-region=\"viewer-navigation-panel\"]').getAttribute('data-rid'),\n                        title: title\n                    }\n\n                    Templates.render('report_reflectionexporter/pdf_container', context).done(function (html, js) {\n\n                        Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\n\n                        const pdfData = self.pdfData;\n                        // The workerSrc property shall be specified.\n                        PDFJSLIB.GlobalWorkerOptions.workerSrc = url.relativeUrl('/report/reflectionexporter/amd/src/pdf.worker.js');\n                        var loadingTask = PDFJSLIB.getDocument({\n                            data: atob(pdfData)\n                        });\n                        var currPage = 1;\n                        var numPages = 0;\n                        var thePDF = null;\n\n                        loadingTask.promise.then(function (pdf) {\n\n                            //Set PDFJS global object (so we can easily access in our page functions\n                            thePDF = pdf;\n\n                            //How many pages it has\n                            numPages = pdf.numPages;\n\n                            // In chase the PDF was rendered before\n                            // deleteCanvas();\n\n                            //Start with first page\n                            pdf.getPage(1).then(handlePages).catch(error => console.log(error));\n                        }, function (reason) {\n                            console.error(reason);\n                        });\n\n                        async function handlePages(page) {\n                            //This gives us the page's dimensions at full scale\n                            var viewport = page.getViewport({\n                                scale: 1.5\n                            });\n                            //We'll create a canvas for each page to draw it on\n\n                            var canvas = document.createElement(\"canvas\");\n                            canvas.classList.add('pdf-page');\n                            canvas.height = viewport.height;\n                            canvas.width = viewport.width;\n                            var context = canvas.getContext('2d');\n\n                            // Draw it on the canvas\n                            await page.render({\n                                canvasContext: context,\n                                viewport: viewport\n                            });\n\n                            //Add it to the web page\n                            document.getElementById('viewer').appendChild(canvas);\n\n                            //Move to next page\n                            currPage++;\n\n                            if (thePDF !== null && currPage <= numPages) {\n                                thePDF.getPage(currPage).then(handlePages);\n                            }\n                        }\n\n                        // Display the form or status\n                        if (!self.completed) {\n                            document.querySelector('form.reflection-comment-form').removeAttribute('hidden');\n                            document.querySelector('button.save-show-next-btn').addEventListener('click', self._saveshownext.bind(self));\n                            document.querySelector('button.save-exit-btn').addEventListener('click', self._savesandexit.bind(self));\n                        } else {\n                            document.querySelector('h4.reflection-completed').classList.add('reflection-completed-display');\n                            document.querySelector('h4.reflection-completed').classList.remove('reflection-completed');\n\n                            // Check if its the last student, if so, display the download button.\n                            const select = document.querySelector(\"[data-action='change-user']\");\n\n                            if (select.options[select.selectedIndex].nextElementSibling == null) {\n                                self._enableDownloadAndSummary();\n                            }\n                        }\n                    });\n\n\n\n                },\n                fail: function (reason) {\n                    console.log(reason);\n                },\n            }, ]);\n        });\n    }\n\n\n    ViewPDF.prototype._getUser = function () {\n        const userid = $('[data-action=\"change-user\"]')[0].getAttribute('data-selected');\n        const pdfjsons = JSON.parse(document.querySelector('div.data-pdfjson').getAttribute('data-pdfs'));\n        const user = pdfjsons.filter(user => {\n            if (user.userid == userid) return user;\n        });\n        return user;\n    }\n\n    ViewPDF.prototype._getUserId = function () {\n        return $('[data-action=\"change-user\"]')[0].getAttribute('data-selected');\n    }\n\n    ViewPDF.prototype._saveshownext = function (e) {\n\n        e.preventDefault();\n        console.log(e);\n        this._save('shownext'); // TODO: Get the name of the button from the e object\n\n    }\n\n    // Save the data in BD\n    ViewPDF.prototype._save = async function (btnClicked) {\n\n        //Get the teacher comment from the textarea\n        const commentEl = document.getElementById('comment');\n        // Check it has content.\n        if (commentEl.value.length === 0) {\n            commentEl.classList.add('comment_error');\n            return;\n        } else {\n            commentEl.classList.remove('comment_error');\n\n            const pdfData = this.pdfData;\n            const stringPdfToBinary = Uint8Array.from(atob(pdfData), (c) => c.charCodeAt(0));\n\n            const pdfDoc = await PDFLib.PDFDocument.load(stringPdfToBinary);\n            const form = pdfDoc.getForm();\n            //Text12: Supervisor comments.\n            let commentsupervisor;\n\n            switch (ReHelper.get_ibform_name()) {\n                case 'EE_RPPF':\n                    commentsupervisor = form.getField(ReHelper.get_ee_form_inputs().SUPERVISOR_COMMENT);\n                    break;\n                case 'TK_PPF':\n                    commentsupervisor = form.getField(ReHelper.get_tok_form_inputs().TEACHER_COMMENTS);\n                    var today = new Date();\n                    const options = { year: 'numeric', month: 'numeric', day: 'numeric' };\n                    today = today.toLocaleString(\"en-GB\", options);\n                    const commentdate1 = form.getField(ReHelper.get_tok_form_inputs().COMPLETED_DECLARATION_DATE1);\n                    const commentdate2 = form.getField(ReHelper.get_tok_form_inputs().COMPLETED_DECLARATION_DATE2);\n                    commentdate1.setText(today);\n                    commentdate2.setText(today);\n                    break;\n\n                default:\n                    break;\n            }\n\n            commentsupervisor.setText(commentEl.value);\n\n            // Flatten the form's fields. This makes the pdf uneditable.\n            form.flatten();\n            // Save the PDF with the teacher comment. Cant edit anymore\n            const pdf = await pdfDoc.saveAsBase64();\n\n            const user = this._getUser();\n            const select = document.querySelector(\"[data-action='change-user']\");\n\n            const toUpdate = {\n                id: user[0].id,\n                userid: $('[data-action=\"change-user\"]')[0].getAttribute('data-selected'),\n                courseid: $('[data-region=\"user-info\"]')[0].getAttribute('data-userid'),\n                refexid: $('[data-region=\"user-info\"]')[0].getAttribute('data-rid'),\n                pdf: pdf,\n                exit: '0',\n                finished: select.options[select.selectedIndex].nextElementSibling == null ? '1' : '0'\n            }\n            if (btnClicked != 'shownext') { // CLicked on exit\n                toUpdate.exit = '1';\n            }\n\n            // Update the pdf value in mdl_report_reflec_exporter_pdf\n            this._updatePDFInDB(toUpdate);\n\n        }\n    }\n    // Call WS to save pdf data in DB.\n    ViewPDF.prototype._updatePDFInDB = function (record) {\n\n        const self = this;\n        const arg = JSON.stringify(record);\n        const exit = record.exit;\n\n        Ajax.call([{\n            methodname: \"report_reflectionexporter_update_pdfbase64\",\n            args: {\n                pdf: arg,\n            },\n            done: function (response) {\n                console.log(response);\n\n                // if it comes from save and exit. redirect to the course.\n                if (exit == '1') {\n                    // This way we cant go back.\n                    window.location.replace(document.getElementById(\"courseurl\").getAttribute('href'));\n                    return;\n                }\n\n                // update the pdfjson with the status, so it cant be edited anymore\n                self._updatejson();\n\n                const userid = document.querySelector(\"[data-action='change-user']\").getAttribute('data-selected');\n                const useridnumber = parseInt(userid, 10);\n                const select = document.querySelector(\"[data-action='change-user']\");\n\n                document.getElementById('comment').value = ''; // Clear the textarea\n\n                if (select.options[select.selectedIndex].nextElementSibling != null) { // Check we didnt reach the end.\n\n                    const nextuser = select.options[select.selectedIndex].nextElementSibling.value;\n\n                    select.setAttribute('data-selected', nextuser);\n                    select.value = String(nextuser);\n\n                    // Trigger user change with the id of the next user.\n                    if (!isNaN(useridnumber) && useridnumber > 0) {\n                        $(document).trigger('user-changed', nextuser);\n                    }\n\n                } else {\n                    $(document).trigger('user-changed', userid);\n                }\n\n\n\n            },\n            fail: function (reason) {\n                console.log(reason);\n            },\n        }, ]);\n    }\n\n    ViewPDF.prototype._zipdownload = function (e) {\n        document.getElementById('zipform').submit();\n    }\n\n\n    ViewPDF.prototype._savesandexit = function (e) {\n        e.preventDefault();\n        this._save('showexit');\n    }\n\n    ViewPDF.prototype._updatejson = function () {\n\n        const json = JSON.parse(document.querySelector('.data-pdfjson').getAttribute('data-pdfs'));\n        const userid = document.querySelector(\"[data-action='change-user']\").getAttribute('data-selected');\n        var i = 0;\n        for (i; i < json.length; i++) {\n            if (json[i].userid == userid) {\n                json[i].status = 'C';\n                break;\n            }\n        }\n\n        document.querySelector('.data-pdfjson').setAttribute('data-pdfs', JSON.stringify(json));\n    }\n\n    ViewPDF.prototype._enableDownloadAndSummary = function () {\n        const self = this;\n        document.querySelector('div.next-action').classList.remove('next-action-hidden');\n        document.getElementById('download').addEventListener('click', self._zipdownload);\n\n        // Only display if there are no processes.\n        let notprocess = document.querySelector('.importing-animation').getAttribute('data-notprocess');\n        notprocess = parseInt(notprocess, 10);\n\n        if (notprocess > 0) {\n            document.getElementById('summary').classList.remove('btn-summary-hidden');\n            document.getElementById('summary').addEventListener('click', self._loadsummary);\n        }\n\n        if (ReHelper.get_ibform_name() === 'TK_PPF') {\n            document.getElementById('export').addEventListener('click', self._spreadsheetdowndload);\n        }\n    }\n\n    ViewPDF.prototype._loadsummary = function () {\n\n        Ajax.call([{\n            methodname: \"report_reflectionexporter_get_ommited\",\n            args: {\n                recordid: document.querySelector('[data-region=\"viewer-navigation-panel\"]').getAttribute('data-rid'),\n            },\n            done: function (response) {\n\n                let context = {\n                    students: JSON.parse(response.context)\n                };\n                console.log(context);\n\n                Templates.render('report_reflectionexporter/students_table', context).done(function (html, js) {\n                    Templates.replaceNodeContents(document.querySelector('div.omitted-table'), html, js);\n                    var modal = document.getElementById(\"myModal\");\n                    var span = document.getElementsByClassName(\"close\")[0];\n                    modal.style.display = \"block\"\n                    span.onclick = function () {\n                        modal.style.display = \"none\";\n                    }\n\n                    // When the user clicks anywhere outside of the modal, close it.\n                    window.onclick = function (event) {\n                        if (event.target == modal) {\n                            modal.style.display = \"none\";\n                        }\n                    }\n                })\n\n\n            },\n            fail: function (reason) {\n                console.log(reason);\n            },\n        }, ]);\n    }\n\n    ViewPDF.prototype._spreadsheetdowndload = function () {\n        document.getElementById('exportspreadsheet').submit();\n    }\n\n    return ViewPDF;\n\n});"],"names":["define","PDFJSLIB","PDFLib","ReHelper","Templates","Ajax","url","ViewPDF","$","document","on","this","_init","bind","prototype","self","render","done","html","js","fadeOut","replaceNodeContents","fadeIn","user","_getUser","call","methodname","args","recorid","id","response","downloadurl","URL","window","location","href","exporturl","istkform","pdfData","pdfbase64","searchParams","append","completed","status","get_ibform_name","console","log","context","courseurl","getElementById","getAttribute","downloadaction","datajson","querySelector","tkform","exportspreadhseetaction","summaryicon","imageUrl","zipicon","exporticon","rid","title","GlobalWorkerOptions","workerSrc","relativeUrl","loadingTask","getDocument","data","atob","currPage","numPages","thePDF","handlePages","page","viewport","getViewport","scale","canvas","createElement","classList","add","height","width","getContext","canvasContext","appendChild","getPage","then","promise","pdf","catch","error","reason","remove","select","options","selectedIndex","nextElementSibling","_enableDownloadAndSummary","removeAttribute","addEventListener","_saveshownext","_savesandexit","fail","userid","JSON","parse","filter","_getUserId","e","preventDefault","_save","async","btnClicked","commentEl","value","length","stringPdfToBinary","Uint8Array","from","c","charCodeAt","pdfDoc","PDFDocument","load","form","getForm","commentsupervisor","getField","get_ee_form_inputs","SUPERVISOR_COMMENT","get_tok_form_inputs","TEACHER_COMMENTS","today","Date","year","month","day","toLocaleString","commentdate1","COMPLETED_DECLARATION_DATE1","commentdate2","COMPLETED_DECLARATION_DATE2","setText","flatten","saveAsBase64","toUpdate","courseid","refexid","exit","finished","_updatePDFInDB","record","arg","stringify","replace","_updatejson","useridnumber","parseInt","nextuser","setAttribute","String","isNaN","trigger","_zipdownload","submit","json","i","notprocess","_loadsummary","_spreadsheetdowndload","recordid","students","modal","span","getElementsByClassName","style","display","onclick","event","target"],"mappings":"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"}