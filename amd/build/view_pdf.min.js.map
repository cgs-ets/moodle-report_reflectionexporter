{"version":3,"file":"view_pdf.min.js","sources":["../src/view_pdf.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript to handle the PDF view\r\n *\r\n * @module     report_reflectionexporter/vew_pdf\r\n * @copyright  2022 Veronica Bermegui\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([\r\n    \"report_reflectionexporter/pdf\",\r\n    \"report_reflectionexporter/pdf-lib\",\r\n    \"report_reflectionexporter/reflectionexporterHelper\",\r\n    'core/templates',\r\n    'core/ajax',\r\n    'core/url'\r\n], function (PDFJSLIB, PDFLib, ReHelper, Templates, Ajax, url) {\r\n    \"use strict\";\r\n\r\n    var ViewPDF = function () {\r\n        $(document).on('user-changed', this._init.bind(this));\r\n    }\r\n\r\n    ViewPDF.prototype._init = function () {\r\n        var self = this;\r\n\r\n        Templates.render('report_reflectionexporter/loading', {}).done(function (html, js) {\r\n            // Update the page.\r\n            //$('[data-region=\"pdf-comment-container\"]').fadeOut(\"fast\", function () {\r\n            //Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\r\n            //$('[data-region=\"pdf-comment-container\"]').fadeIn(\"fast\");\r\n            //}.bind(this));\r\n\r\n            const user = self._getUser();\r\n\r\n            // Call the service that returns the PDF.\r\n            Ajax.call([{\r\n                methodname: \"report_reflectionexporter_get_pdfbase64\",\r\n                args: {\r\n                    recorid: user[0].id, // This is the id of the record that  in mdl_report_reflec_exporter_pdf\r\n                },\r\n                done: function (response) {\r\n\r\n                    // Render the pdf container\r\n                    const downloadurl = new URL(window.location.href);\r\n                    const exporturl = new URL(window.location.href);\r\n                    let istkform = false;\r\n                    let title = 'This form has been completed';\r\n\r\n                    self.pdfData = response.pdfbase64;\r\n                    downloadurl.searchParams.append('d', 1);\r\n                    self.completed = user[0].status == 'C' ? true : false;\r\n\r\n\r\n                    if (ReHelper.get_ibform_name() === 'TK_PPF') {\r\n                        istkform = true;\r\n                        exporturl.searchParams.append('export', 1);\r\n                    }\r\n\r\n                    const context = {\r\n                        courseurl: document.getElementById(\"courseurl\").getAttribute('href'),\r\n                        downloadaction: downloadurl,\r\n                        datajson: document.querySelector('.data-pdfjson').getAttribute('data-pdfs'),\r\n                        completed: user[0].status == 'C' ? true : false,\r\n                        tkform: istkform,\r\n                        exportspreadhseetaction: exporturl,\r\n                        summaryicon: url.imageUrl('clipboard', 'report_reflectionexporter'),\r\n                        zipicon: url.imageUrl('zip', 'report_reflectionexporter'),\r\n                        exporticon: url.imageUrl('spreadsheet', 'report_reflectionexporter'),\r\n                        rid: document.querySelector('[data-region=\"viewer-navigation-panel\"]').getAttribute('data-rid'),\r\n                        title: title,\r\n                        maxcommentlength: istkform ? 200 : 542\r\n                    }\r\n\r\n                    Templates.render('report_reflectionexporter/pdf_container', context).done(function (html, js) {\r\n\r\n                        Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\r\n\r\n                        const pdfData = self.pdfData;\r\n                        // The workerSrc property shall be specified.\r\n                        PDFJSLIB.GlobalWorkerOptions.workerSrc = url.relativeUrl('/report/reflectionexporter/amd/src/pdf.worker.js');\r\n                        var loadingTask = PDFJSLIB.getDocument({\r\n                            data: atob(pdfData)\r\n                        });\r\n                        var currPage = 1;\r\n                        var numPages = 0;\r\n                        var thePDF = null;\r\n\r\n                        loadingTask.promise.then(function (pdf) {\r\n                            //Set PDFJS global object (so we can easily access in our page functions\r\n                            thePDF = pdf;\r\n\r\n                            //How many pages it has\r\n                            numPages = pdf.numPages;\r\n\r\n                            // In chase the PDF was rendered before\r\n                            // deleteCanvas();\r\n\r\n                            //Start with first page\r\n                            pdf.getPage(1).then(handlePages).catch(error => console.log(error));\r\n                        }, function (reason) {\r\n                            console.log(\"loadingTask promise fail\");\r\n                            console.error(reason);\r\n                        });\r\n\r\n                        async function handlePages(page) {\r\n                            //This gives us the page's dimensions at full scale\r\n                            var viewport = page.getViewport({\r\n                                scale: 1.5\r\n                            });\r\n\r\n                            //We'll create a canvas for each page to draw it on\r\n                            var canvas = document.createElement(\"canvas\");\r\n                            canvas.classList.add('pdf-page');\r\n                            canvas.height = viewport.height;\r\n                            canvas.width = viewport.width;\r\n                            var context = canvas.getContext('2d');\r\n\r\n                            // Draw it on the canvas\r\n                            await page.render({\r\n                                canvasContext: context,\r\n                                viewport: viewport\r\n                            });\r\n\r\n                            //Add it to the web page\r\n                            document.getElementById('viewer').appendChild(canvas);\r\n\r\n                            //Move to next page\r\n                            currPage++;\r\n\r\n                            if (thePDF !== null && currPage <= numPages) {\r\n                                thePDF.getPage(currPage).then(handlePages);\r\n                            }\r\n                        }\r\n\r\n                        // Display the form or status\r\n                        if (!self.completed) {\r\n                            document.querySelector('form.reflection-comment-form').removeAttribute('hidden');\r\n                            document.querySelector('form.reflection-comment-form').addEventListener('keydown', self._checkwordLength.bind(self))\r\n                            document.querySelector('button.save-show-next-btn').addEventListener('click', self._saveshownext.bind(self));\r\n                            document.querySelector('button.save-exit-btn').addEventListener('click', self._savesandexit.bind(self));\r\n                        } else {\r\n                            document.querySelector('h4.reflection-completed').classList.add('reflection-completed-display');\r\n                            document.querySelector('h4.reflection-completed').classList.remove('reflection-completed');\r\n\r\n                            // Check if its the last student, if so, display the download button.\r\n                            const select = document.querySelector(\"[data-action='change-user']\");\r\n\r\n                            if (select.options[select.selectedIndex].nextElementSibling == null) {\r\n                                self._enableDownloadAndSummary();\r\n                            }\r\n                        }\r\n                    }).fail(function (error) {\r\n                        console.error(error);\r\n                    });\r\n\r\n\r\n\r\n                },\r\n                fail: function (reason) {\r\n                    console.log(reason);\r\n                },\r\n            },]);\r\n        }).fail(function (error) {\r\n            console.error(error);\r\n        });\r\n    }\r\n\r\n\r\n    ViewPDF.prototype._getUser = function () {\r\n        const userid = $('[data-action=\"change-user\"]')[0].getAttribute('data-selected');\r\n        const pdfjsons = JSON.parse(document.querySelector('div.data-pdfjson').getAttribute('data-pdfs'));\r\n        const user = pdfjsons.filter(user => {\r\n            if (user.userid == userid) return user;\r\n        });\r\n        return user;\r\n    }\r\n\r\n    ViewPDF.prototype._getUserId = function () {\r\n        return $('[data-action=\"change-user\"]')[0].getAttribute('data-selected');\r\n    }\r\n\r\n    ViewPDF.prototype._saveshownext = function (e) {\r\n\r\n        e.preventDefault();\r\n        //console.log(e);\r\n        this._save('shownext'); // TODO: Get the name of the button from the e object\r\n\r\n    }\r\n\r\n    ViewPDF.prototype._checkwordLength = function (e) {\r\n        console.log('_checkwordLength');\r\n        const wordLen = ReHelper.get_ibform_name() === 'TK_PPF' ? 200 : 542\r\n        var len = e.target.value.split(/[\\s]+/);\r\n        document.querySelector('.reflectionexporter-comment-len-warning').setAttribute('hidden', 1);\r\n        console.log(len);\r\n        if (len.length > wordLen) {\r\n            document.querySelector('.reflectionexporter-comment-len-warning').removeAttribute('hidden')\r\n            e.target.oldValue = e.target.value != e.target.oldValue ? e.target.value : e.target.oldValue;\r\n            e.target.value = e.target.oldValue;\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    // Save the data in BD\r\n    ViewPDF.prototype._save = async function (btnClicked) {\r\n\r\n        //Get the teacher comment from the textarea\r\n        const commentEl = document.getElementById('comment');\r\n\r\n\r\n        // Check it has content.\r\n        if (commentEl.value.length === 0) {\r\n            commentEl.classList.add('comment_error');\r\n            return;\r\n        } else {\r\n            commentEl.classList.remove('comment_error');\r\n\r\n            const pdfData = this.pdfData;\r\n            const stringPdfToBinary = Uint8Array.from(atob(pdfData), (c) => c.charCodeAt(0));\r\n\r\n            const pdfDoc = await PDFLib.PDFDocument.load(stringPdfToBinary);\r\n            const form = pdfDoc.getForm();\r\n            //Text12: Supervisor comments.\r\n            let commentsupervisor;\r\n\r\n            switch (ReHelper.get_ibform_name()) {\r\n                case 'EE_RPPF':\r\n                    commentsupervisor = form.getField(ReHelper.get_ee_form_inputs().SUPERVISOR_COMMENT);\r\n                    break;\r\n                case 'TK_PPF':\r\n                    commentsupervisor = form.getField(ReHelper.get_tok_form_inputs().TEACHER_COMMENTS);\r\n                    var today = new Date();\r\n                    const options = { year: 'numeric', month: 'numeric', day: 'numeric' };\r\n                    today = today.toLocaleString(\"en-GB\", options);\r\n                    const commentdate1 = form.getField(ReHelper.get_tok_form_inputs().COMPLETED_DECLARATION_DATE1);\r\n                    const commentdate2 = form.getField(ReHelper.get_tok_form_inputs().COMPLETED_DECLARATION_DATE2);\r\n                    commentdate1.setText(today);\r\n                    commentdate2.setText(today);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            commentsupervisor.setText(commentEl.value);\r\n\r\n            // Flatten the form's fields. This makes the pdf uneditable.\r\n            form.flatten();\r\n            // Save the PDF with the teacher comment. Cant edit anymore\r\n            const pdf = await pdfDoc.saveAsBase64();\r\n\r\n            const user = this._getUser();\r\n            const select = document.querySelector(\"[data-action='change-user']\");\r\n\r\n            const toUpdate = {\r\n                id: user[0].id,\r\n                userid: $('[data-action=\"change-user\"]')[0].getAttribute('data-selected'),\r\n                courseid: $('[data-region=\"user-info\"]')[0].getAttribute('data-userid'),\r\n                refexid: $('[data-region=\"user-info\"]')[0].getAttribute('data-rid'),\r\n                pdf: pdf,\r\n                exit: '0',\r\n                finished: select.options[select.selectedIndex].nextElementSibling == null ? '1' : '0'\r\n            }\r\n            if (btnClicked != 'shownext') { // CLicked on exit\r\n                toUpdate.exit = '1';\r\n            }\r\n\r\n            // Update the pdf value in mdl_report_reflec_exporter_pdf\r\n            this._updatePDFInDB(toUpdate);\r\n\r\n        }\r\n    }\r\n    // Call WS to save pdf data in DB.\r\n    ViewPDF.prototype._updatePDFInDB = function (record) {\r\n\r\n        const self = this;\r\n        const arg = JSON.stringify(record);\r\n        const exit = record.exit;\r\n\r\n        Ajax.call([{\r\n            methodname: \"report_reflectionexporter_update_pdfbase64\",\r\n            args: {\r\n                pdf: arg,\r\n            },\r\n            done: function (response) {\r\n                //console.log(response);\r\n\r\n                // if it comes from save and exit. redirect to the course.\r\n                if (exit == '1') {\r\n                    // This way we cant go back.\r\n                    window.location.replace(document.getElementById(\"courseurl\").getAttribute('href'));\r\n                    return;\r\n                }\r\n\r\n                // update the pdfjson with the status, so it cant be edited anymore\r\n                self._updatejson();\r\n\r\n                const userid = document.querySelector(\"[data-action='change-user']\").getAttribute('data-selected');\r\n                const useridnumber = parseInt(userid, 10);\r\n                const select = document.querySelector(\"[data-action='change-user']\");\r\n\r\n                document.getElementById('comment').value = ''; // Clear the textarea\r\n\r\n                if (select.options[select.selectedIndex].nextElementSibling != null) { // Check we didnt reach the end.\r\n\r\n                    const nextuser = select.options[select.selectedIndex].nextElementSibling.value;\r\n\r\n                    select.setAttribute('data-selected', nextuser);\r\n                    select.value = String(nextuser);\r\n\r\n                    // Trigger user change with the id of the next user.\r\n                    if (!isNaN(useridnumber) && useridnumber > 0) {\r\n                        $(document).trigger('user-changed', nextuser);\r\n                    }\r\n\r\n                } else {\r\n                    $(document).trigger('user-changed', userid);\r\n                }\r\n\r\n\r\n\r\n            },\r\n            fail: function (reason) {\r\n                console.log(reason);\r\n            },\r\n        },]);\r\n    }\r\n\r\n    ViewPDF.prototype._zipdownload = function (e) {\r\n        document.getElementById('zipform').submit();\r\n    }\r\n\r\n\r\n    ViewPDF.prototype._savesandexit = function (e) {\r\n        e.preventDefault();\r\n        this._save('showexit');\r\n    }\r\n\r\n    ViewPDF.prototype._updatejson = function () {\r\n\r\n        const json = JSON.parse(document.querySelector('.data-pdfjson').getAttribute('data-pdfs'));\r\n        const userid = document.querySelector(\"[data-action='change-user']\").getAttribute('data-selected');\r\n        var i = 0;\r\n        for (i; i < json.length; i++) {\r\n            if (json[i].userid == userid) {\r\n                json[i].status = 'C';\r\n                break;\r\n            }\r\n        }\r\n\r\n        document.querySelector('.data-pdfjson').setAttribute('data-pdfs', JSON.stringify(json));\r\n    }\r\n\r\n    ViewPDF.prototype._enableDownloadAndSummary = function () {\r\n        const self = this;\r\n        document.querySelector('div.next-action').classList.remove('next-action-hidden');\r\n        document.getElementById('download').addEventListener('click', self._zipdownload);\r\n\r\n        // Only display if there are no processes.\r\n        let notprocess = document.querySelector('.importing-animation').getAttribute('data-notprocess');\r\n        notprocess = parseInt(notprocess, 10);\r\n\r\n        if (notprocess > 0) {\r\n            document.getElementById('summary').classList.remove('btn-summary-hidden');\r\n            document.getElementById('summary').addEventListener('click', self._loadsummary);\r\n        }\r\n\r\n        if (ReHelper.get_ibform_name() === 'TK_PPF') {\r\n            document.getElementById('export').addEventListener('click', self._spreadsheetdowndload);\r\n        }\r\n    }\r\n\r\n    ViewPDF.prototype._loadsummary = function () {\r\n\r\n        Ajax.call([{\r\n            methodname: \"report_reflectionexporter_get_ommited\",\r\n            args: {\r\n                recordid: document.querySelector('[data-region=\"viewer-navigation-panel\"]').getAttribute('data-rid'),\r\n            },\r\n            done: function (response) {\r\n\r\n                let context = {\r\n                    students: JSON.parse(response.context)\r\n                };\r\n                //console.log(context);\r\n\r\n                Templates.render('report_reflectionexporter/students_table', context).done(function (html, js) {\r\n                    Templates.replaceNodeContents(document.querySelector('div.omitted-table'), html, js);\r\n                    var modal = document.getElementById(\"myModal\");\r\n                    var span = document.getElementsByClassName(\"close\")[0];\r\n                    modal.style.display = \"block\"\r\n                    span.onclick = function () {\r\n                        modal.style.display = \"none\";\r\n                    }\r\n\r\n                    // When the user clicks anywhere outside of the modal, close it.\r\n                    window.onclick = function (event) {\r\n                        if (event.target == modal) {\r\n                            modal.style.display = \"none\";\r\n                        }\r\n                    }\r\n                })\r\n\r\n\r\n            },\r\n            fail: function (reason) {\r\n                console.log(reason);\r\n            },\r\n        },]);\r\n    }\r\n\r\n    ViewPDF.prototype._spreadsheetdowndload = function () {\r\n        document.getElementById('exportspreadsheet').submit();\r\n    }\r\n\r\n    return ViewPDF;\r\n\r\n});"],"names":["define","PDFJSLIB","PDFLib","ReHelper","Templates","Ajax","url","ViewPDF","$","document","on","this","_init","bind","prototype","self","render","done","html","js","user","_getUser","call","methodname","args","recorid","id","response","downloadurl","URL","window","location","href","exporturl","istkform","pdfData","pdfbase64","searchParams","append","completed","status","get_ibform_name","context","courseurl","getElementById","getAttribute","downloadaction","datajson","querySelector","tkform","exportspreadhseetaction","summaryicon","imageUrl","zipicon","exporticon","rid","title","maxcommentlength","replaceNodeContents","GlobalWorkerOptions","workerSrc","relativeUrl","loadingTask","getDocument","data","atob","currPage","numPages","thePDF","handlePages","page","viewport","getViewport","scale","canvas","createElement","classList","add","height","width","getContext","canvasContext","appendChild","getPage","then","promise","pdf","catch","error","console","log","reason","remove","select","options","selectedIndex","nextElementSibling","_enableDownloadAndSummary","removeAttribute","addEventListener","_checkwordLength","_saveshownext","_savesandexit","fail","userid","JSON","parse","filter","_getUserId","e","preventDefault","_save","wordLen","len","target","value","split","setAttribute","length","oldValue","async","btnClicked","commentEl","stringPdfToBinary","Uint8Array","from","c","charCodeAt","pdfDoc","PDFDocument","load","form","getForm","commentsupervisor","getField","get_ee_form_inputs","SUPERVISOR_COMMENT","get_tok_form_inputs","TEACHER_COMMENTS","today","Date","year","month","day","toLocaleString","commentdate1","COMPLETED_DECLARATION_DATE1","commentdate2","COMPLETED_DECLARATION_DATE2","setText","flatten","saveAsBase64","toUpdate","courseid","refexid","exit","finished","_updatePDFInDB","record","arg","stringify","replace","_updatejson","useridnumber","parseInt","nextuser","String","isNaN","trigger","_zipdownload","submit","json","i","notprocess","_loadsummary","_spreadsheetdowndload","recordid","students","modal","span","getElementsByClassName","style","display","onclick","event"],"mappings":";;;;;;;AAuBAA,4CAAO,CACH,gCACA,oCACA,qDACA,iBACA,YACA,aACD,SAAUC,SAAUC,OAAQC,SAAUC,UAAWC,KAAMC,SAGlDC,QAAU,WACVC,EAAEC,UAAUC,GAAG,eAAgBC,KAAKC,MAAMC,KAAKF,eAGnDJ,QAAQO,UAAUF,MAAQ,eAClBG,KAAOJ,KAEXP,UAAUY,OAAO,oCAAqC,IAAIC,MAAK,SAAUC,KAAMC,UAOrEC,KAAOL,KAAKM,WAGlBhB,KAAKiB,KAAK,CAAC,CACPC,WAAY,0CACZC,KAAM,CACFC,QAASL,KAAK,GAAGM,IAErBT,KAAM,SAAUU,gBAGNC,YAAc,IAAIC,IAAIC,OAAOC,SAASC,MACtCC,UAAY,IAAIJ,IAAIC,OAAOC,SAASC,UACtCE,UAAW,EAGfnB,KAAKoB,QAAUR,SAASS,UACxBR,YAAYS,aAAaC,OAAO,IAAK,GACrCvB,KAAKwB,UAA8B,KAAlBnB,KAAK,GAAGoB,OAGU,WAA/BrC,SAASsC,oBACTP,UAAW,EACXD,UAAUI,aAAaC,OAAO,SAAU,UAGtCI,QAAU,CACZC,UAAWlC,SAASmC,eAAe,aAAaC,aAAa,QAC7DC,eAAgBlB,YAChBmB,SAAUtC,SAASuC,cAAc,iBAAiBH,aAAa,aAC/DN,UAA6B,KAAlBnB,KAAK,GAAGoB,OACnBS,OAAQf,SACRgB,wBAAyBjB,UACzBkB,YAAa7C,IAAI8C,SAAS,YAAa,6BACvCC,QAAS/C,IAAI8C,SAAS,MAAO,6BAC7BE,WAAYhD,IAAI8C,SAAS,cAAe,6BACxCG,IAAK9C,SAASuC,cAAc,2CAA2CH,aAAa,YACpFW,MAvBQ,+BAwBRC,iBAAkBvB,SAAW,IAAM,KAGvC9B,UAAUY,OAAO,0CAA2C0B,SAASzB,MAAK,SAAUC,KAAMC,IAEtFf,UAAUsD,oBAAoBlD,EAAE,yCAA0CU,KAAMC,UAE1EgB,QAAUpB,KAAKoB,QAErBlC,SAAS0D,oBAAoBC,UAAYtD,IAAIuD,YAAY,wDACrDC,YAAc7D,SAAS8D,YAAY,CACnCC,KAAMC,KAAK9B,WAEX+B,SAAW,EACXC,SAAW,EACXC,OAAS,oBAmBEC,YAAYC,UAEnBC,SAAWD,KAAKE,YAAY,CAC5BC,MAAO,MAIPC,OAASjE,SAASkE,cAAc,UACpCD,OAAOE,UAAUC,IAAI,YACrBH,OAAOI,OAASP,SAASO,OACzBJ,OAAOK,MAAQR,SAASQ,UACpBrC,QAAUgC,OAAOM,WAAW,YAG1BV,KAAKtD,OAAO,CACdiE,cAAevC,QACf6B,SAAUA,WAId9D,SAASmC,eAAe,UAAUsC,YAAYR,QAG9CR,WAEe,OAAXE,QAAmBF,UAAYC,UAC/BC,OAAOe,QAAQjB,UAAUkB,KAAKf,gBA3CtCP,YAAYuB,QAAQD,MAAK,SAAUE,KAE/BlB,OAASkB,IAGTnB,SAAWmB,IAAInB,SAMfmB,IAAIH,QAAQ,GAAGC,KAAKf,aAAakB,OAAMC,OAASC,QAAQC,IAAIF,YAC7D,SAAUG,QACTF,QAAQC,IAAI,4BACZD,QAAQD,MAAMG,WAkCb5E,KAAKwB,UAKH,CACH9B,SAASuC,cAAc,2BAA2B4B,UAAUC,IAAI,gCAChEpE,SAASuC,cAAc,2BAA2B4B,UAAUgB,OAAO,8BAG7DC,OAASpF,SAASuC,cAAc,+BAEyB,MAA3D6C,OAAOC,QAAQD,OAAOE,eAAeC,oBACrCjF,KAAKkF,iCAZTxF,SAASuC,cAAc,gCAAgCkD,gBAAgB,UACvEzF,SAASuC,cAAc,gCAAgCmD,iBAAiB,UAAWpF,KAAKqF,iBAAiBvF,KAAKE,OAC9GN,SAASuC,cAAc,6BAA6BmD,iBAAiB,QAASpF,KAAKsF,cAAcxF,KAAKE,OACtGN,SAASuC,cAAc,wBAAwBmD,iBAAiB,QAASpF,KAAKuF,cAAczF,KAAKE,UAYtGwF,MAAK,SAAUf,OACdC,QAAQD,MAAMA,WAMtBe,KAAM,SAAUZ,QACZF,QAAQC,IAAIC,eAGrBY,MAAK,SAAUf,OACdC,QAAQD,MAAMA,WAKtBjF,QAAQO,UAAUO,SAAW,iBACnBmF,OAAShG,EAAE,+BAA+B,GAAGqC,aAAa,wBAC/C4D,KAAKC,MAAMjG,SAASuC,cAAc,oBAAoBH,aAAa,cAC9D8D,QAAOvF,UACrBA,KAAKoF,QAAUA,OAAQ,OAAOpF,SAK1Cb,QAAQO,UAAU8F,WAAa,kBACpBpG,EAAE,+BAA+B,GAAGqC,aAAa,kBAG5DtC,QAAQO,UAAUuF,cAAgB,SAAUQ,GAExCA,EAAEC,sBAEGC,MAAM,aAIfxG,QAAQO,UAAUsF,iBAAmB,SAAUS,GAC3CpB,QAAQC,IAAI,0BACNsB,QAAyC,WAA/B7G,SAASsC,kBAAiC,IAAM,QAC5DwE,IAAMJ,EAAEK,OAAOC,MAAMC,MAAM,gBAC/B3G,SAASuC,cAAc,2CAA2CqE,aAAa,SAAU,GACzF5B,QAAQC,IAAIuB,OACRA,IAAIK,OAASN,WACbvG,SAASuC,cAAc,2CAA2CkD,gBAAgB,UAClFW,EAAEK,OAAOK,SAAWV,EAAEK,OAAOC,OAASN,EAAEK,OAAOK,SAAWV,EAAEK,OAAOC,MAAQN,EAAEK,OAAOK,SACpFV,EAAEK,OAAOC,MAAQN,EAAEK,OAAOK,UACnB,IAMfhH,QAAQO,UAAUiG,MAAQS,eAAgBC,kBAGhCC,UAAYjH,SAASmC,eAAe,cAIX,IAA3B8E,UAAUP,MAAMG,OAGb,CACHI,UAAU9C,UAAUgB,OAAO,uBAErBzD,QAAUxB,KAAKwB,QACfwF,kBAAoBC,WAAWC,KAAK5D,KAAK9B,UAAW2F,GAAMA,EAAEC,WAAW,KAEvEC,aAAe9H,OAAO+H,YAAYC,KAAKP,mBACvCQ,KAAOH,OAAOI,cAEhBC,yBAEIlI,SAASsC,uBACR,UACD4F,kBAAoBF,KAAKG,SAASnI,SAASoI,qBAAqBC,8BAE/D,SACDH,kBAAoBF,KAAKG,SAASnI,SAASsI,sBAAsBC,sBAC7DC,MAAQ,IAAIC,WACV9C,QAAU,CAAE+C,KAAM,UAAWC,MAAO,UAAWC,IAAK,WAC1DJ,MAAQA,MAAMK,eAAe,QAASlD,eAChCmD,aAAed,KAAKG,SAASnI,SAASsI,sBAAsBS,6BAC5DC,aAAehB,KAAKG,SAASnI,SAASsI,sBAAsBW,6BAClEH,aAAaI,QAAQV,OACrBQ,aAAaE,QAAQV,OAO7BN,kBAAkBgB,QAAQ3B,UAAUP,OAGpCgB,KAAKmB,gBAEChE,UAAY0C,OAAOuB,eAEnBnI,KAAOT,KAAKU,WACZwE,OAASpF,SAASuC,cAAc,+BAEhCwG,SAAW,CACb9H,GAAIN,KAAK,GAAGM,GACZ8E,OAAQhG,EAAE,+BAA+B,GAAGqC,aAAa,iBACzD4G,SAAUjJ,EAAE,6BAA6B,GAAGqC,aAAa,eACzD6G,QAASlJ,EAAE,6BAA6B,GAAGqC,aAAa,YACxDyC,IAAKA,IACLqE,KAAM,IACNC,SAAqE,MAA3D/D,OAAOC,QAAQD,OAAOE,eAAeC,mBAA6B,IAAM,KAEpE,YAAdyB,aACA+B,SAASG,KAAO,UAIfE,eAAeL,eAxDpB9B,UAAU9C,UAAUC,IAAI,kBA6DhCtE,QAAQO,UAAU+I,eAAiB,SAAUC,cAEnC/I,KAAOJ,KACPoJ,IAAMtD,KAAKuD,UAAUF,QACrBH,KAAOG,OAAOH,KAEpBtJ,KAAKiB,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAM,CACF8D,IAAKyE,KAET9I,KAAM,SAAUU,aAIA,KAARgI,iBAEA7H,OAAOC,SAASkI,QAAQxJ,SAASmC,eAAe,aAAaC,aAAa,SAK9E9B,KAAKmJ,oBAEC1D,OAAS/F,SAASuC,cAAc,+BAA+BH,aAAa,iBAC5EsH,aAAeC,SAAS5D,OAAQ,IAChCX,OAASpF,SAASuC,cAAc,kCAEtCvC,SAASmC,eAAe,WAAWuE,MAAQ,GAEoB,MAA3DtB,OAAOC,QAAQD,OAAOE,eAAeC,mBAA4B,OAE3DqE,SAAWxE,OAAOC,QAAQD,OAAOE,eAAeC,mBAAmBmB,MAEzEtB,OAAOwB,aAAa,gBAAiBgD,UACrCxE,OAAOsB,MAAQmD,OAAOD,WAGjBE,MAAMJ,eAAiBA,aAAe,GACvC3J,EAAEC,UAAU+J,QAAQ,eAAgBH,eAIxC7J,EAAEC,UAAU+J,QAAQ,eAAgBhE,SAM5CD,KAAM,SAAUZ,QACZF,QAAQC,IAAIC,aAKxBpF,QAAQO,UAAU2J,aAAe,SAAU5D,GACvCpG,SAASmC,eAAe,WAAW8H,UAIvCnK,QAAQO,UAAUwF,cAAgB,SAAUO,GACxCA,EAAEC,sBACGC,MAAM,aAGfxG,QAAQO,UAAUoJ,YAAc,iBAEtBS,KAAOlE,KAAKC,MAAMjG,SAASuC,cAAc,iBAAiBH,aAAa,cACvE2D,OAAS/F,SAASuC,cAAc,+BAA+BH,aAAa,yBAC9E+H,EAAI,EACAA,EAAID,KAAKrD,OAAQsD,OACjBD,KAAKC,GAAGpE,QAAUA,OAAQ,CAC1BmE,KAAKC,GAAGpI,OAAS,UAKzB/B,SAASuC,cAAc,iBAAiBqE,aAAa,YAAaZ,KAAKuD,UAAUW,QAGrFpK,QAAQO,UAAUmF,0BAA4B,iBACpClF,KAAOJ,KACbF,SAASuC,cAAc,mBAAmB4B,UAAUgB,OAAO,sBAC3DnF,SAASmC,eAAe,YAAYuD,iBAAiB,QAASpF,KAAK0J,kBAG/DI,WAAapK,SAASuC,cAAc,wBAAwBH,aAAa,mBAC7EgI,WAAaT,SAASS,WAAY,IAE9BA,WAAa,IACbpK,SAASmC,eAAe,WAAWgC,UAAUgB,OAAO,sBACpDnF,SAASmC,eAAe,WAAWuD,iBAAiB,QAASpF,KAAK+J,eAGnC,WAA/B3K,SAASsC,mBACThC,SAASmC,eAAe,UAAUuD,iBAAiB,QAASpF,KAAKgK,wBAIzExK,QAAQO,UAAUgK,aAAe,WAE7BzK,KAAKiB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFwJ,SAAUvK,SAASuC,cAAc,2CAA2CH,aAAa,aAE7F5B,KAAM,SAAUU,cAERe,QAAU,CACVuI,SAAUxE,KAAKC,MAAM/E,SAASe,UAIlCtC,UAAUY,OAAO,2CAA4C0B,SAASzB,MAAK,SAAUC,KAAMC,IACvFf,UAAUsD,oBAAoBjD,SAASuC,cAAc,qBAAsB9B,KAAMC,QAC7E+J,MAAQzK,SAASmC,eAAe,WAChCuI,KAAO1K,SAAS2K,uBAAuB,SAAS,GACpDF,MAAMG,MAAMC,QAAU,QACtBH,KAAKI,QAAU,WACXL,MAAMG,MAAMC,QAAU,QAI1BxJ,OAAOyJ,QAAU,SAAUC,OACnBA,MAAMtE,QAAUgE,QAChBA,MAAMG,MAAMC,QAAU,aAOtC/E,KAAM,SAAUZ,QACZF,QAAQC,IAAIC,aAKxBpF,QAAQO,UAAUiK,sBAAwB,WACtCtK,SAASmC,eAAe,qBAAqB8H,UAG1CnK"}