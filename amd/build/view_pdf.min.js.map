{"version":3,"sources":["../src/view_pdf.js"],"names":["define","PDFJSLIB","PDFLib","Templates","Ajax","url","ViewPDF","$","document","on","_init","bind","prototype","self","render","done","html","js","fadeOut","replaceNodeContents","fadeIn","user","_getUser","call","methodname","args","recorid","id","response","pdfData","pdfbase64","downloadurl","URL","window","location","href","searchParams","append","context","courseurl","getElementById","getAttribute","downloadaction","datajson","querySelector","addEventListener","_saveshownext","GlobalWorkerOptions","workerSrc","relativeUrl","loadingTask","getDocument","data","atob","currPage","numPages","thePDF","promise","then","pdf","getPage","handlePages","catch","error","console","log","reason","page","viewport","getViewport","scale","canvas","createElement","classList","add","height","width","getContext","canvasContext","appendChild","fail","userid","pdfjsons","JSON","parse","filter","_getUserId","e","preventDefault","commentEl","value","length","remove","stringPdfToBinary","Uint8Array","from","c","charCodeAt","PDFDocument","load","pdfDoc","form","getForm","commentsupervisor","getField","setText","saveAsBase64","toUpdate","courseid","refexid","_updatePDFInDB","record","arg","stringify","useridnumber","parseInt","select","options","selectedIndex","nextElementSibling","nextuser","setAttribute","isNaN","trigger","TODO","_zipdownload","submit"],"mappings":"kYAuBAA,OAAM,sCAAC,CACH,+BADG,CAEH,mCAFG,CAGH,gBAHG,CAIH,WAJG,CAKH,UALG,CAAD,CAMH,SAAUC,CAAV,CAAoBC,CAApB,CAA4BC,CAA5B,CAAuCC,CAAvC,CAA6CC,CAA7C,CAAkD,CACjD,aAEA,GAAIC,CAAAA,CAAO,CAAG,UAAY,CAEtBC,CAAC,CAACC,QAAD,CAAD,CAAYC,EAAZ,CAAe,cAAf,CAA+B,KAAKC,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAA/B,CAGH,CALD,CAOAL,CAAO,CAACM,SAAR,CAAkBF,KAAlB,CAA0B,UAAY,CAClC,GAAIG,CAAAA,CAAI,CAAG,IAAX,CAEAV,CAAS,CAACW,MAAV,CAAiB,mCAAjB,CAAsD,EAAtD,EAA0DC,IAA1D,CAA+D,SAAUC,CAAV,CAAgBC,CAAhB,CAAoB,CAE/EV,CAAC,CAAC,yCAAD,CAAD,CAA2CW,OAA3C,CAAmD,MAAnD,CAA2D,UAAY,CACnEf,CAAS,CAACgB,mBAAV,CAA8BZ,CAAC,CAAC,yCAAD,CAA/B,CAA0ES,CAA1E,CAAgFC,CAAhF,EACAV,CAAC,CAAC,yCAAD,CAAD,CAA2Ca,MAA3C,CAAkD,MAAlD,CAEH,CAJ0D,CAIzDT,IAJyD,CAIpD,IAJoD,CAA3D,EAMA,GAAMU,CAAAA,CAAI,CAAGR,CAAI,CAACS,QAAL,EAAb,CAIAlB,CAAI,CAACmB,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,yCADL,CAEPC,IAAI,CAAE,CACFC,OAAO,CAAEL,CAAI,CAAC,CAAD,CAAJ,CAAQM,EADf,CAFC,CAKPZ,IAAI,CAAE,cAAUa,CAAV,CAAoB,CAItBf,CAAI,CAACgB,OAAL,CAAeD,CAAQ,CAACE,SAAxB,CACA,GAAMC,CAAAA,CAAW,CAAG,GAAIC,CAAAA,GAAJ,CAAQC,MAAM,CAACC,QAAP,CAAgBC,IAAxB,CAApB,CACAJ,CAAW,CAACK,YAAZ,CAAyBC,MAAzB,CAAgC,GAAhC,CAAqC,CAArC,EACA,GAAMC,CAAAA,CAAO,CAAG,CACZC,SAAS,CAAE/B,QAAQ,CAACgC,cAAT,CAAwB,WAAxB,EAAqCC,YAArC,CAAkD,MAAlD,CADC,CAEZC,cAAc,CAAEX,CAFJ,CAGZY,QAAQ,CAAEnC,QAAQ,CAACoC,aAAT,CAAuB,eAAvB,EAAwCH,YAAxC,CAAqD,WAArD,CAHE,CAAhB,CAKAtC,CAAS,CAACW,MAAV,CAAiB,yCAAjB,CAA4DwB,CAA5D,EAAqEvB,IAArE,CAA0E,SAAUC,CAAV,CAAgBC,CAAhB,CAAoB,CAE1Fd,CAAS,CAACgB,mBAAV,CAA8BZ,CAAC,CAAC,yCAAD,CAA/B,CAA0ES,CAA1E,CAAgFC,CAAhF,EAEAT,QAAQ,CAACoC,aAAT,CAAuB,2BAAvB,EAAoDC,gBAApD,CAAqE,OAArE,CAA8EhC,CAAI,CAACiC,aAAL,CAAmBnC,IAAnB,CAAwBE,CAAxB,CAA9E,EAEA,GAAMgB,CAAAA,CAAO,CAAGhB,CAAI,CAACgB,OAArB,CAEA5B,CAAQ,CAAC8C,mBAAT,CAA6BC,SAA7B,CAAyC3C,CAAG,CAAC4C,WAAJ,CAAgB,kDAAhB,CAAzC,CAR0F,GAStFC,CAAAA,CAAW,CAAGjD,CAAQ,CAACkD,WAAT,CAAqB,CACnCC,IAAI,CAAEC,IAAI,CAACxB,CAAD,CADyB,CAArB,CATwE,CAYtFyB,CAAQ,CAAG,CAZ2E,CAatFC,CAAQ,CAAG,CAb2E,CActFC,CAAM,CAAG,IAd6E,CAgB1FN,CAAW,CAACO,OAAZ,CAAoBC,IAApB,CAAyB,SAAUC,CAAV,CAAe,CAGpCH,CAAM,CAAGG,CAAT,CAGAJ,CAAQ,CAAGI,CAAG,CAACJ,QAAf,CAMAI,CAAG,CAACC,OAAJ,CAAY,CAAZ,EAAeF,IAAf,CAAoBG,CAApB,EAAiCC,KAAjC,CAAuC,SAAAC,CAAK,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ,CAAJ,CAA5C,CACH,CAbD,CAaG,SAAUG,CAAV,CAAkB,CACjBF,OAAO,CAACD,KAAR,CAAcG,CAAd,CACH,CAfD,EAhB0F,QAiC3EL,CAAAA,CAjC2E,2FAiC1F,WAA2BM,CAA3B,6FAEQC,CAFR,CAEmBD,CAAI,CAACE,WAAL,CAAiB,CAC5BC,KAAK,CAAE,GADqB,CAAjB,CAFnB,CAOQC,CAPR,CAOiB/D,QAAQ,CAACgE,aAAT,CAAuB,QAAvB,CAPjB,CAQID,CAAM,CAACE,SAAP,CAAiBC,GAAjB,CAAqB,UAArB,EACAH,CAAM,CAACI,MAAP,CAAgBP,CAAQ,CAACO,MAAzB,CACAJ,CAAM,CAACK,KAAP,CAAeR,CAAQ,CAACQ,KAAxB,CACItC,CAXR,CAWkBiC,CAAM,CAACM,UAAP,CAAkB,IAAlB,CAXlB,gBAcUV,CAAAA,CAAI,CAACrD,MAAL,CAAY,CACdgE,aAAa,CAAExC,CADD,CAEd8B,QAAQ,CAAEA,CAFI,CAAZ,CAdV,QAoBI5D,QAAQ,CAACgC,cAAT,CAAwB,QAAxB,EAAkCuC,WAAlC,CAA8CR,CAA9C,EAGAjB,CAAQ,GAER,GAAe,IAAX,GAAAE,CAAM,EAAaF,CAAQ,EAAIC,CAAnC,CAA6C,CACzCC,CAAM,CAACI,OAAP,CAAeN,CAAf,EAAyBI,IAAzB,CAA8BG,CAA9B,CACH,CA3BL,yCAjC0F,kCAuE7F,CAvED,CA2EH,CA5FM,CA6FPmB,IAAI,CAAE,cAAUd,CAAV,CAAkB,CACpBF,OAAO,CAACC,GAAR,CAAYC,CAAZ,CACH,CA/FM,CAAD,CAAV,CAiGH,CA7GD,CA8GH,CAjHD,CAoHA5D,CAAO,CAACM,SAAR,CAAkBU,QAAlB,CAA6B,UAAY,IAC/B2D,CAAAA,CAAM,CAAG1E,CAAC,CAAC,+BAAD,CAAD,CAAiC,CAAjC,EAAoCkC,YAApC,CAAiD,eAAjD,CADsB,CAE/ByC,CAAQ,CAAGC,IAAI,CAACC,KAAL,CAAW5E,QAAQ,CAACoC,aAAT,CAAuB,kBAAvB,EAA2CH,YAA3C,CAAwD,WAAxD,CAAX,CAFoB,CAG/BpB,CAAI,CAAG6D,CAAQ,CAACG,MAAT,CAAgB,SAAAhE,CAAI,CAAI,CACjC,GAAIA,CAAI,CAAC4D,MAAL,EAAeA,CAAnB,CAA2B,MAAO5D,CAAAA,CACrC,CAFY,CAHwB,CAMrC,MAAOA,CAAAA,CACV,CAPD,CASAf,CAAO,CAACM,SAAR,CAAkB0E,UAAlB,CAA+B,UAAY,CACvC,MAAO/E,CAAAA,CAAC,CAAC,+BAAD,CAAD,CAAiC,CAAjC,EAAoCkC,YAApC,CAAiD,eAAjD,CACV,CAFD,CAIAnC,CAAO,CAACM,SAAR,CAAkBkC,aAAlB,4DAAkC,WAAgByC,CAAhB,yGAE9BA,CAAC,CAACC,cAAF,GAOMC,CATwB,CASZjF,QAAQ,CAACgC,cAAT,CAAwB,SAAxB,CATY,MAWC,CAA3B,GAAAiD,CAAS,CAACC,KAAV,CAAgBC,MAXU,kBAY1BF,CAAS,CAAChB,SAAV,CAAoBC,GAApB,CAAwB,eAAxB,EAZ0B,iCAe1Be,CAAS,CAAChB,SAAV,CAAoBmB,MAApB,CAA2B,eAA3B,EAEM/D,CAjBoB,CAiBV,KAAKA,OAjBK,CAkBpBgE,CAlBoB,CAkBAC,UAAU,CAACC,IAAX,CAAgB1C,IAAI,CAACxB,CAAD,CAApB,CAA+B,SAACmE,CAAD,QAAOA,CAAAA,CAAC,CAACC,UAAF,CAAa,CAAb,CAAP,CAA/B,CAlBA,iBAoBL/F,CAAAA,CAAM,CAACgG,WAAP,CAAmBC,IAAnB,CAAwBN,CAAxB,CApBK,SAoBpBO,CApBoB,QAqBpBC,CArBoB,CAqBbD,CAAM,CAACE,OAAP,EArBa,CAuBpBC,CAvBoB,CAuBAF,CAAI,CAACG,QAAL,CAAc,QAAd,CAvBA,CAwB1BD,CAAiB,CAACE,OAAlB,CAA0BhB,CAAS,CAACC,KAApC,EAxB0B,gBA0BRU,CAAAA,CAAM,CAACM,YAAP,EA1BQ,SA0BpB/C,CA1BoB,QA4BpBtC,CA5BoB,CA4Bb,KAAKC,QAAL,EA5Ba,CA6BpBqF,CA7BoB,CA6BT,CACbhF,EAAE,CAAEN,CAAI,CAAC,CAAD,CAAJ,CAAQM,EADC,CAEbsD,MAAM,CAAE1E,CAAC,CAAC,+BAAD,CAAD,CAAiC,CAAjC,EAAoCkC,YAApC,CAAiD,eAAjD,CAFK,CAGbmE,QAAQ,CAAErG,CAAC,CAAC,6BAAD,CAAD,CAA+B,CAA/B,EAAkCkC,YAAlC,CAA+C,aAA/C,CAHG,CAIboE,OAAO,CAAEtG,CAAC,CAAC,6BAAD,CAAD,CAA+B,CAA/B,EAAkCkC,YAAlC,CAA+C,UAA/C,CAJI,CAKbkB,GAAG,CAAEA,CALQ,CA7BS,CAsC1B,KAAKmD,cAAL,CAAoBH,CAApB,EAtC0B,8CAAlC,wDA6CArG,CAAO,CAACM,SAAR,CAAkBkG,cAAlB,CAAmC,SAAUC,CAAV,CAAkB,IAC3ClG,CAAAA,CAAI,CAAG,IADoC,CAE3CmG,CAAG,CAAG7B,IAAI,CAAC8B,SAAL,CAAeF,CAAf,CAFqC,CAIjD3G,CAAI,CAACmB,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,4CADL,CAEPC,IAAI,CAAE,CACFkC,GAAG,CAAEqD,CADH,CAFC,CAKPjG,IAAI,CAAE,cAAUa,CAAV,CAAoB,CACtBoC,OAAO,CAACC,GAAR,CAAYrC,CAAZ,EADsB,GAGhBqD,CAAAA,CAAM,CAAGzE,QAAQ,CAACoC,aAAT,CAAuB,6BAAvB,EAAsDH,YAAtD,CAAmE,eAAnE,CAHO,CAIhByE,CAAY,CAAGC,QAAQ,CAAClC,CAAD,CAAS,EAAT,CAJP,CAKhBmC,CAAM,CAAG5G,QAAQ,CAACoC,aAAT,CAAuB,6BAAvB,CALO,CAOtBpC,QAAQ,CAACgC,cAAT,CAAwB,SAAxB,EAAmCkD,KAAnC,CAA2C,EAA3C,CAEA,GAA+D,IAA3D,EAAA0B,CAAM,CAACC,OAAP,CAAeD,CAAM,CAACE,aAAtB,EAAqCC,kBAAzC,CAAqE,CAEjE,GAAMC,CAAAA,CAAQ,CAAGJ,CAAM,CAACC,OAAP,CAAeD,CAAM,CAACE,aAAtB,EAAqCC,kBAArC,CAAwD7B,KAAzE,CAEA0B,CAAM,CAACK,YAAP,CAAoB,eAApB,CAAqCD,CAArC,EAEAJ,CAAM,CAAC1B,KAAP,CAAsB8B,CAAtB,IAEA,GAAI,CAACE,KAAK,CAACR,CAAD,CAAN,EAAuC,CAAf,CAAAA,CAA5B,CAA8C,CAC1C3G,CAAC,CAACC,QAAD,CAAD,CAAYmH,OAAZ,CAAoB,cAApB,CAAoCH,CAApC,CACH,CAEJ,CAZD,IAYO,CACHI,IAAI,CACJ5D,OAAO,CAACC,GAAR,CAAY,OAAZ,EACAD,OAAO,CAACC,GAAR,CAAYpD,CAAZ,EAEAL,QAAQ,CAACoC,aAAT,CAAuB,iBAAvB,EAA0C6B,SAA1C,CAAoDmB,MAApD,CAA2D,oBAA3D,EACApF,QAAQ,CAACgC,cAAT,CAAwB,UAAxB,EAAoCK,gBAApC,CAAqD,OAArD,CAA8DhC,CAAI,CAACgH,YAAnE,CACH,CAEJ,CAnCM,CAoCP7C,IAAI,CAAE,cAAUd,CAAV,CAAkB,CACpBF,OAAO,CAACC,GAAR,CAAYC,CAAZ,CACH,CAtCM,CAAD,CAAV,CAwCH,CA5CD,CA8CA5D,CAAO,CAACM,SAAR,CAAkBiH,YAAlB,CAAiC,UAAa,CAEzCrH,QAAQ,CAACgC,cAAT,CAAwB,SAAxB,EAAmCsF,MAAnC,EAiBJ,CAnBD,CAqBA,MAAOxH,CAAAA,CAEV,CAnQK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle the PDF view\n *\n * @module     report_reflectionexporter/vew_pdf\n * @copyright  2022 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    \"report_reflectionexporter/pdf\",\n    \"report_reflectionexporter/pdf-lib\",\n    'core/templates',\n    'core/ajax',\n    'core/url'\n], function (PDFJSLIB, PDFLib, Templates, Ajax, url) {\n    \"use strict\";\n\n    var ViewPDF = function () {\n\n        $(document).on('user-changed', this._init.bind(this));\n\n\n    }\n\n    ViewPDF.prototype._init = function () {\n        var self = this;\n\n        Templates.render('report_reflectionexporter/loading', {}).done(function (html, js) {\n            // Update the page.\n            $('[data-region=\"pdf-comment-container\"]').fadeOut(\"fast\", function () {\n                Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\n                $('[data-region=\"pdf-comment-container\"]').fadeIn(\"fast\");\n\n            }.bind(this));\n\n            const user = self._getUser();\n\n\n            // Llama al servico que me devuelve el pdf\n            Ajax.call([{\n                methodname: \"report_reflectionexporter_get_pdfbase64\",\n                args: {\n                    recorid: user[0].id, // This is the id of the record that  in mdl_report_reflec_exporter_pdf\n                },\n                done: function (response) {\n\n                    // Render the pdf container\n\n                    self.pdfData = response.pdfbase64;\n                    const downloadurl = new URL(window.location.href);\n                    downloadurl.searchParams.append('d', 1);\n                    const context = {\n                        courseurl: document.getElementById(\"courseurl\").getAttribute('href'),\n                        downloadaction: downloadurl,\n                        datajson: document.querySelector('.data-pdfjson').getAttribute('data-pdfs')\n                    }\n                    Templates.render('report_reflectionexporter/pdf_container', context).done(function (html, js) {\n\n                        Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\n\n                        document.querySelector('button.save-show-next-btn').addEventListener('click', self._saveshownext.bind(self));\n\n                        const pdfData = self.pdfData;\n                        // The workerSrc property shall be specified.\n                        PDFJSLIB.GlobalWorkerOptions.workerSrc = url.relativeUrl('/report/reflectionexporter/amd/src/pdf.worker.js');\n                        var loadingTask = PDFJSLIB.getDocument({\n                            data: atob(pdfData)\n                        });\n                        var currPage = 1;\n                        var numPages = 0;\n                        var thePDF = null;\n\n                        loadingTask.promise.then(function (pdf) {\n\n                            //Set PDFJS global object (so we can easily access in our page functions\n                            thePDF = pdf;\n\n                            //How many pages it has\n                            numPages = pdf.numPages;\n\n                            // In chase the PDF was rendered before\n                            // deleteCanvas();\n\n                            //Start with first page\n                            pdf.getPage(1).then(handlePages).catch(error => console.log(error));\n                        }, function (reason) {\n                            console.error(reason);\n                        });\n\n                        async function handlePages(page) {\n                            //This gives us the page's dimensions at full scale\n                            var viewport = page.getViewport({\n                                scale: 1.5\n                            });\n                            //We'll create a canvas for each page to draw it on\n\n                            var canvas = document.createElement(\"canvas\");\n                            canvas.classList.add('pdf-page');\n                            canvas.height = viewport.height;\n                            canvas.width = viewport.width;\n                            var context = canvas.getContext('2d');\n\n                            // Draw it on the canvas\n                            await page.render({\n                                canvasContext: context,\n                                viewport: viewport\n                            });\n\n                            //Add it to the web page\n                            document.getElementById('viewer').appendChild(canvas);\n\n                            //Move to next page\n                            currPage++;\n\n                            if (thePDF !== null && currPage <= numPages) {\n                                thePDF.getPage(currPage).then(handlePages);\n                            }\n                        }\n\n                        function deleteCanvas() {\n                            const viewer = document.getElementById('viewer');\n                            var child = viewer.lastElementChild;\n                            while (child) {\n                                viewer.removeChild(child);\n                                child = viewer.lastElementChild;\n                            }\n                        }\n                    });\n\n\n\n                },\n                fail: function (reason) {\n                    console.log(reason);\n                },\n            }, ]);\n        });\n    }\n\n\n    ViewPDF.prototype._getUser = function () {\n        const userid = $('[data-action=\"change-user\"]')[0].getAttribute('data-selected');\n        const pdfjsons = JSON.parse(document.querySelector('div.data-pdfjson').getAttribute('data-pdfs'));\n        const user = pdfjsons.filter(user => {\n            if (user.userid == userid) return user;\n        });\n        return user;\n    }\n\n    ViewPDF.prototype._getUserId = function () {\n        return $('[data-action=\"change-user\"]')[0].getAttribute('data-selected');\n    }\n\n    ViewPDF.prototype._saveshownext = async function (e) {\n\n        e.preventDefault();\n\n        // get the pdf and put the value from the textarea\n        // call ajax to update the pdf saved and put it in the pdfjson. so if the user navigates, the content is in there\n        // after its adone, get the next user\n\n        //Get the teacher comment from the textarea\n        const commentEl = document.getElementById('comment');\n        // Check it has content.\n        if (commentEl.value.length === 0) {\n            commentEl.classList.add('comment_error');\n            return;\n        } else {\n            commentEl.classList.remove('comment_error');\n\n            const pdfData = this.pdfData;\n            const stringPdfToBinary = Uint8Array.from(atob(pdfData), (c) => c.charCodeAt(0));\n\n            const pdfDoc = await PDFLib.PDFDocument.load(stringPdfToBinary);\n            const form = pdfDoc.getForm();\n            //Text12: Supervisor comments.\n            const commentsupervisor = form.getField('Text12');\n            commentsupervisor.setText(commentEl.value);\n            // Save the PDF with the teacher comment\n            const pdf = await pdfDoc.saveAsBase64();\n\n            const user = this._getUser();\n            const toUpdate = {\n                id: user[0].id,\n                userid: $('[data-action=\"change-user\"]')[0].getAttribute('data-selected'),\n                courseid: $('[data-region=\"user-info\"]')[0].getAttribute('data-userid'),\n                refexid: $('[data-region=\"user-info\"]')[0].getAttribute('data-rid'),\n                pdf: pdf\n            }\n\n            // Update the pdf value in mdl_report_reflec_exporter_pdf\n            this._updatePDFInDB(toUpdate);\n\n        }\n\n    }\n\n    // Call WS to save pdf data in DB.\n    ViewPDF.prototype._updatePDFInDB = function (record) {\n        const self = this;\n        const arg = JSON.stringify(record);\n\n        Ajax.call([{\n            methodname: \"report_reflectionexporter_update_pdfbase64\",\n            args: {\n                pdf: arg,\n            },\n            done: function (response) {\n                console.log(response);\n                // Trigger user change with the id of the next user\n                const userid = document.querySelector(\"[data-action='change-user']\").getAttribute('data-selected');\n                const useridnumber = parseInt(userid, 10);\n                const select = document.querySelector(\"[data-action='change-user']\");\n\n                document.getElementById('comment').value = ''; // Clear the textarea\n\n                if (select.options[select.selectedIndex].nextElementSibling != null) { // Check we didnt reach the end.\n\n                    const nextuser = select.options[select.selectedIndex].nextElementSibling.value;\n\n                    select.setAttribute('data-selected', nextuser);\n\n                    select.value = String(nextuser);\n\n                    if (!isNaN(useridnumber) && useridnumber > 0) {\n                        $(document).trigger('user-changed', nextuser);\n                    }\n\n                } else {\n                    TODO: //mostrar la opcion para armar el zip\n                    console.log(\"final\");\n                    console.log(self);\n                    //Display the actions\n                    document.querySelector('div.next-action').classList.remove('next-action-hidden');\n                    document.getElementById('download').addEventListener('click', self._zipdownload);\n                }\n\n            },\n            fail: function (reason) {\n                console.log(reason);\n            },\n        }, ]);\n    }\n\n    ViewPDF.prototype._zipdownload = function (e) {\n      //  e.preventDefault();\n         document.getElementById('zipform').submit()\n        // Ajax.call([{\n        //     methodname: \"report_reflectionexporter_get_zip\",\n        //     args: {\n        //         data: document.querySelector('.data-pdfjson').getAttribute('data-pdfs'),\n        //     },\n        //     done: function (response) {\n        //         console.log(response);\n        //         window.location = response.file;\n\n        //     },\n        //     fail: function (reason) {\n        //         console.log(reason);\n        //     },\n        // }, ]);\n\n        // TODO: crear un servicio que va a descargar el zip\n    }\n\n    return ViewPDF;\n\n});"],"file":"view_pdf.min.js"}