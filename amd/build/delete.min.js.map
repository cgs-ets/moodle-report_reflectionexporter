{"version":3,"file":"delete.min.js","sources":["../src/delete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n *\r\n *\r\n * @package    report\r\n * @subpackage reflectionexporter\r\n * @copyright  2022 Veronica Bermegui\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([\r\n    'core/ajax',\r\n\r\n], function (Ajax) {\r\n    \"use strict\";\r\n\r\n    var Delete = function () {\r\n       \r\n        if (document.querySelector(\"tbody\") != null) {\r\n\r\n            this._addEventListeners();\r\n        }\r\n    }\r\n\r\n\r\n\r\n    Delete.prototype._addEventListeners = function () {\r\n        const self = this;\r\n        const table = document.querySelector(\"tbody\");\r\n        for (const row of table.rows) {\r\n            const l = row.cells.length - 1;\r\n            const cl = (row.cells[l]).children.length - 2;\r\n            const aElement = row.cells[l].children[cl];\r\n            console.log(aElement);\r\n            aElement.setAttribute('data-row-index', row.rowIndex);\r\n            aElement.addEventListener('click', self._deleteService.bind(this));\r\n        }\r\n    }\r\n\r\n    Delete.prototype._deleteService = function (e) {\r\n      \r\n        const self = this;\r\n       \r\n        self.rowIndex = e.srcElement.parentElement.parentElement.parentElement.rowIndex - 1;\r\n\r\n        // Call the service\r\n       \r\n        //Hide the bin and show the processing\r\n        e.srcElement.parentElement.classList.add('deleting');\r\n        e.srcElement.parentElement.nextElementSibling.classList.remove('deleting');\r\n      \r\n        Ajax.call([{\r\n            methodname: \"report_reflectionexporter_delete_process\",\r\n            args: {\r\n                rid: e.target.getAttribute('data-to-delete')\r\n            },\r\n            done: function (response) {\r\n                console.log(response);\r\n                // remove table row\r\n               \r\n                document.querySelector(\"tbody\").deleteRow(self.rowIndex);\r\n\r\n                // check if its the last row. if so, remove the table completely\r\n                if (document.querySelector(\"tbody\").rows.length == 0) {\r\n                    document.querySelector('div.select-work').classList.add('deleting');\r\n                }\r\n\r\n            },\r\n            fail: function (reason) {\r\n                console.log(reason);\r\n            }\r\n        }]);\r\n\r\n    }\r\n\r\n\r\n\r\n    return Delete;\r\n\r\n});"],"names":["define","Ajax","Delete","document","querySelector","_addEventListeners","prototype","self","this","table","row","rows","l","cells","length","cl","children","aElement","console","log","setAttribute","rowIndex","addEventListener","_deleteService","bind","e","srcElement","parentElement","classList","add","nextElementSibling","remove","call","methodname","args","rid","target","getAttribute","done","response","deleteRow","fail","reason"],"mappings":";;;;;;;;AAwBAA,0CAAO,CACH,cAED,SAAUC,UAGLC,OAAS,WAE8B,MAAnCC,SAASC,cAAc,eAElBC,6BAMbH,OAAOI,UAAUD,mBAAqB,iBAC5BE,KAAOC,KACPC,MAAQN,SAASC,cAAc,aAChC,MAAMM,OAAOD,MAAME,KAAM,OACpBC,EAAIF,IAAIG,MAAMC,OAAS,EACvBC,GAAML,IAAIG,MAAMD,GAAII,SAASF,OAAS,EACtCG,SAAWP,IAAIG,MAAMD,GAAGI,SAASD,IACvCG,QAAQC,IAAIF,UACZA,SAASG,aAAa,iBAAkBV,IAAIW,UAC5CJ,SAASK,iBAAiB,QAASf,KAAKgB,eAAeC,KAAKhB,SAIpEN,OAAOI,UAAUiB,eAAiB,SAAUE,SAElClB,KAAOC,KAEbD,KAAKc,SAAWI,EAAEC,WAAWC,cAAcA,cAAcA,cAAcN,SAAW,EAKlFI,EAAEC,WAAWC,cAAcC,UAAUC,IAAI,YACzCJ,EAAEC,WAAWC,cAAcG,mBAAmBF,UAAUG,OAAO,YAE/D9B,KAAK+B,KAAK,CAAC,CACPC,WAAY,2CACZC,KAAM,CACFC,IAAKV,EAAEW,OAAOC,aAAa,mBAE/BC,KAAM,SAAUC,UACZrB,QAAQC,IAAIoB,UAGZpC,SAASC,cAAc,SAASoC,UAAUjC,KAAKc,UAGI,GAA/ClB,SAASC,cAAc,SAASO,KAAKG,QACrCX,SAASC,cAAc,mBAAmBwB,UAAUC,IAAI,aAIhEY,KAAM,SAAUC,QACZxB,QAAQC,IAAIuB,aAQjBxC"}