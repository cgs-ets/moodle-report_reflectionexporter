{"version":3,"file":"delete.min.js","sources":["../src/delete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n *\n * @package    report\n * @subpackage reflectionexporter\n * @copyright  2022 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'core/ajax',\n\n], function (Ajax) {\n    \"use strict\";\n\n    var Delete = function () {\n\n        if (document.querySelector(\"tbody\") != null) {\n\n            this._addEventListeners();\n        }\n    }\n\n\n\n    Delete.prototype._addEventListeners = function () {\n        const self = this;\n        const table = document.querySelector(\"tbody\");\n        for (const row of table.rows) {\n            const l = row.cells.length - 1;\n            const cl = (row.cells[l]).children.length - 2;\n            const aElement = row.cells[l].children[cl];\n            console.log(aElement);\n            aElement.setAttribute('data-row-index', row.rowIndex);\n            aElement.addEventListener('click', self._deleteService.bind(this));\n        }\n    }\n\n    Delete.prototype._deleteService = function (e) {\n\n        const self = this;\n\n        self.rowIndex = e.srcElement.parentElement.parentElement.parentElement.rowIndex - 1;\n\n        // Call the service\n\n        //Hide the bin and show the processing\n        e.srcElement.parentElement.classList.add('deleting');\n        e.srcElement.parentElement.nextElementSibling.classList.remove('deleting');\n\n        Ajax.call([{\n            methodname: \"report_reflectionexporter_delete_process\",\n            args: {\n                rid: e.target.getAttribute('data-to-delete')\n            },\n            done: function (response) {\n                console.log(response);\n                // remove table row\n\n                document.querySelector(\"tbody\").deleteRow(self.rowIndex);\n\n                // check if its the last row. if so, remove the table completely\n                if (document.querySelector(\"tbody\").rows.length == 0) {\n                    document.querySelector('div.select-work').classList.add('deleting');\n                }\n\n            },\n            fail: function (reason) {\n                console.log(reason);\n            }\n        }]);\n\n    }\n\n\n\n    return Delete;\n\n});"],"names":["define","Ajax","Delete","document","querySelector","_addEventListeners","prototype","self","this","table","row","rows","l","cells","length","cl","children","aElement","console","log","setAttribute","rowIndex","addEventListener","_deleteService","bind","e","srcElement","parentElement","classList","add","nextElementSibling","remove","call","methodname","args","rid","target","getAttribute","done","response","deleteRow","fail","reason"],"mappings":";;;;;;;;AAwBAA,0CAAO,CACH,cAED,SAAUC,UAGLC,OAAS,WAE8B,MAAnCC,SAASC,cAAc,eAElBC,6BAMbH,OAAOI,UAAUD,mBAAqB,iBAC5BE,KAAOC,KACPC,MAAQN,SAASC,cAAc,aAChC,MAAMM,OAAOD,MAAME,KAAM,OACpBC,EAAIF,IAAIG,MAAMC,OAAS,EACvBC,GAAML,IAAIG,MAAMD,GAAII,SAASF,OAAS,EACtCG,SAAWP,IAAIG,MAAMD,GAAGI,SAASD,IACvCG,QAAQC,IAAIF,UACZA,SAASG,aAAa,iBAAkBV,IAAIW,UAC5CJ,SAASK,iBAAiB,QAASf,KAAKgB,eAAeC,KAAKhB,SAIpEN,OAAOI,UAAUiB,eAAiB,SAAUE,SAElClB,KAAOC,KAEbD,KAAKc,SAAWI,EAAEC,WAAWC,cAAcA,cAAcA,cAAcN,SAAW,EAKlFI,EAAEC,WAAWC,cAAcC,UAAUC,IAAI,YACzCJ,EAAEC,WAAWC,cAAcG,mBAAmBF,UAAUG,OAAO,YAE/D9B,KAAK+B,KAAK,CAAC,CACPC,WAAY,2CACZC,KAAM,CACFC,IAAKV,EAAEW,OAAOC,aAAa,mBAE/BC,KAAM,SAAUC,UACZrB,QAAQC,IAAIoB,UAGZpC,SAASC,cAAc,SAASoC,UAAUjC,KAAKc,UAGI,GAA/ClB,SAASC,cAAc,SAASO,KAAKG,QACrCX,SAASC,cAAc,mBAAmBwB,UAAUC,IAAI,aAIhEY,KAAM,SAAUC,QACZxB,QAAQC,IAAIuB,aAQjBxC"}