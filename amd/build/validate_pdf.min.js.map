{"version":3,"sources":["../src/validate_pdf.js"],"names":["define","PDFLib","ReflectionExporter","URL","ValidatePDF","data","console","log","_isForm","prototype","fetch","fileurl","then","res","arrayBuffer","formPdfBytes","PDFDocument","load","pdfDoc","form","getForm","fields","getFields","length","link","relativeUrl","cid","cmid","rid","wf","window","location","replace","init","JSON","parse","document","querySelector","getAttribute"],"mappings":"kYAwBAA,OAAM,0CAAC,CACH,mCADG,CAEH,8CAFG,CAGH,UAHG,CAAD,CAMH,SAAUC,CAAV,CAAkBC,CAAlB,CAAsCC,CAAtC,CAA2C,CAC1C,aAEA,GAAIC,CAAAA,CAAW,CAAG,SAAUC,CAAV,CAAgB,CAC9BC,OAAO,CAACC,GAAR,CAAY,aAAZ,EACA,KAAKC,OAAL,CAAaH,CAAb,CAEH,CAJD,CAOAD,CAAW,CAACK,SAAZ,CAAsBD,OAAtB,4DAAgC,WAAgBH,CAAhB,gHAEDK,CAAAA,KAAK,CAACL,CAAI,CAACM,OAAN,CAAL,CAAoBC,IAApB,CAAyB,SAACC,CAAD,QAASA,CAAAA,CAAG,CAACC,WAAJ,EAAT,CAAzB,CAFC,QAEtBC,CAFsB,uBAGPd,CAAAA,CAAM,CAACe,WAAP,CAAmBC,IAAnB,CAAwBF,CAAxB,CAHO,QAGtBG,CAHsB,QAItBC,CAJsB,CAIfD,CAAM,CAACE,OAAP,EAJe,CAKtBC,CALsB,CAKbF,CAAI,CAACG,SAAL,EALa,MAOP,CAAjB,EAAAD,CAAM,CAACE,MAPiB,mBASxBjB,OAAO,CAACC,GAAR,CAAYF,CAAZ,EACAC,OAAO,CAACC,GAAR,CAAYc,CAAZ,EACMG,CAXkB,CAWVrB,CAAG,CAACsB,WAAJ,CAAgB,sCAAhB,CAAwD,CAClEC,GAAG,CAAErB,CAAI,CAACqB,GADwD,CAElEC,IAAI,CAAEtB,CAAI,CAACsB,IAFuD,CAGlEC,GAAG,CAAEvB,CAAI,CAACuB,GAHwD,CAIlEC,EAAE,CAAE,CAJ8D,CAAxD,CAXU,CAkBxBvB,OAAO,CAACC,GAAR,CAAYiB,CAAZ,EACAM,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwBR,CAAxB,EAnBwB,kCAsBxBtB,CAAkB,CAAC+B,IAAnB,CAAwBC,IAAI,CAACC,KAAL,CAAWC,QAAQ,CAACC,aAAT,CAAuB,sBAAvB,EAA+CC,YAA/C,CAA4D,WAA5D,CAAX,CAAxB,EAtBwB,yCAAhC,wDA6BA,MAAOlC,CAAAA,CAEV,CA/CK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * Validate that the PDF provided is a form.\n * @package    report\n * @subpackage reflectionexporter\n * @copyright  2022 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'report_reflectionexporter/pdf-lib',\n    'report_reflectionexporter/reflectionexporter',\n    'core/url'\n\n\n], function (PDFLib, ReflectionExporter, URL) {\n    \"use strict\";\n\n    var ValidatePDF = function (data) {\n        console.log(\"ValidatePDF\");\n        this._isForm(data);\n\n    }\n\n\n    ValidatePDF.prototype._isForm = async function (data) {\n\n        const formPdfBytes = await fetch(data.fileurl).then((res) => res.arrayBuffer());\n        const pdfDoc = await PDFLib.PDFDocument.load(formPdfBytes);\n        const form = pdfDoc.getForm();\n        const fields = form.getFields();\n\n        if (fields.length == 0) {\n            // take the user back to t\n            console.log(data);\n            console.log(fields);\n            const link  = URL.relativeUrl('/report/reflectionexporter/index.php', {\n                cid: data.cid,\n                cmid: data.cmid,\n                rid: data.rid,\n                wf: 1,\n            });\n\n            console.log(link);\n            window.location.replace(link);\n            return;\n        } else {\n            ReflectionExporter.init(JSON.parse(document.querySelector('.importing-animation').getAttribute('data-info')))\n        }\n    }\n\n\n\n\n    return ValidatePDF;\n\n});"],"file":"validate_pdf.min.js"}