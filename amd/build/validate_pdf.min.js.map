{"version":3,"file":"validate_pdf.min.js","sources":["../src/validate_pdf.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n *\r\n * Validate that the PDF provided is a form.\r\n * @package    report\r\n * @subpackage reflectionexporter\r\n * @copyright  2022 Veronica Bermegui\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([\r\n    'report_reflectionexporter/pdf-lib',\r\n    'report_reflectionexporter/dispatchjob',\r\n    'core/url'\r\n\r\n\r\n], function (PDFLib, Dispatcher, URL) {\r\n    \"use strict\";\r\n\r\n    var ValidatePDF = function (data) {\r\n        this._isForm(data);\r\n    }\r\n\r\n\r\n    ValidatePDF.prototype._isForm = async function (data) {\r\n\r\n        const formPdfBytes = await fetch(data.fileurl).then((res) => res.arrayBuffer());\r\n        const pdfDoc = await PDFLib.PDFDocument.load(formPdfBytes);\r\n        const form = pdfDoc.getForm();\r\n        const fields = form.getFields();\r\n\r\n        if (fields.length == 0) {\r\n            // take the user back.\r\n            const link = URL.relativeUrl('/report/reflectionexporter/index.php', {\r\n                cid: data.cid,\r\n                cmid: data.cmid,\r\n                rid: data.rid,\r\n                wf: 1,\r\n            });\r\n\r\n            window.location.replace(link);\r\n            return;\r\n        } else {\r\n            Dispatcher.init(JSON.parse(document.querySelector('.importing-animation').getAttribute('data-info')))\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    return ValidatePDF;\r\n\r\n});"],"names":["define","PDFLib","Dispatcher","URL","ValidatePDF","data","_isForm","prototype","async","formPdfBytes","fetch","fileurl","then","res","arrayBuffer","PDFDocument","load","getForm","getFields","length","init","JSON","parse","document","querySelector","getAttribute","link","relativeUrl","cid","cmid","rid","wf","window","location","replace"],"mappings":";;;;;;;;AAwBAA,gDAAO,CACH,oCACA,wCACA,aAGD,SAAUC,OAAQC,WAAYC,SAGzBC,YAAc,SAAUC,WACnBC,QAAQD,cAIjBD,YAAYG,UAAUD,QAAUE,eAAgBH,YAEtCI,mBAAqBC,MAAML,KAAKM,SAASC,MAAMC,KAAQA,IAAIC,mBAK5C,UAJAb,OAAOc,YAAYC,KAAKP,eACzBQ,UACAC,YAETC,OAYPjB,WAAWkB,KAAKC,KAAKC,MAAMC,SAASC,cAAc,wBAAwBC,aAAa,0BAVjFC,KAAOvB,IAAIwB,YAAY,uCAAwC,CACjEC,IAAKvB,KAAKuB,IACVC,KAAMxB,KAAKwB,KACXC,IAAKzB,KAAKyB,IACVC,GAAI,IAGRC,OAAOC,SAASC,QAAQR,QAUzBtB"}