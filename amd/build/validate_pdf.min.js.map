{"version":3,"file":"validate_pdf.min.js","sources":["../src/validate_pdf.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * Validate that the PDF provided is a form.\n * @package    report\n * @subpackage reflectionexporter\n * @copyright  2022 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'report_reflectionexporter/pdf-lib',\n    'report_reflectionexporter/dispatchjob',\n    'core/url'\n\n\n], function (PDFLib, Dispatcher, URL) {\n    \"use strict\";\n\n    var ValidatePDF = function (data) {\n        this._isForm(data);\n    }\n\n\n    ValidatePDF.prototype._isForm = async function (data) {\n\n        const formPdfBytes = await fetch(data.fileurl).then((res) => res.arrayBuffer());\n        const pdfDoc = await PDFLib.PDFDocument.load(formPdfBytes);\n        const form = pdfDoc.getForm();\n        const fields = form.getFields();\n\n        if (fields.length == 0) {\n            // take the user back.\n            const link = URL.relativeUrl('/report/reflectionexporter/index.php', {\n                cid: data.cid,\n                cmid: data.cmid,\n                rid: data.rid,\n                wf: 1,\n            });\n\n            window.location.replace(link);\n            return;\n        } else {\n            Dispatcher.init(JSON.parse(document.querySelector('.importing-animation').getAttribute('data-info')))\n        }\n    }\n\n\n\n\n    return ValidatePDF;\n\n});"],"names":["define","PDFLib","Dispatcher","URL","ValidatePDF","data","_isForm","prototype","async","formPdfBytes","fetch","fileurl","then","res","arrayBuffer","PDFDocument","load","getForm","getFields","length","init","JSON","parse","document","querySelector","getAttribute","link","relativeUrl","cid","cmid","rid","wf","window","location","replace"],"mappings":";;;;;;;;AAwBAA,gDAAO,CACH,oCACA,wCACA,aAGD,SAAUC,OAAQC,WAAYC,SAGzBC,YAAc,SAAUC,WACnBC,QAAQD,cAIjBD,YAAYG,UAAUD,QAAUE,eAAgBH,YAEtCI,mBAAqBC,MAAML,KAAKM,SAASC,MAAMC,KAAQA,IAAIC,mBAK5C,UAJAb,OAAOc,YAAYC,KAAKP,eACzBQ,UACAC,YAETC,OAYPjB,WAAWkB,KAAKC,KAAKC,MAAMC,SAASC,cAAc,wBAAwBC,aAAa,0BAVjFC,KAAOvB,IAAIwB,YAAY,uCAAwC,CACjEC,IAAKvB,KAAKuB,IACVC,KAAMxB,KAAKwB,KACXC,IAAKzB,KAAKyB,IACVC,GAAI,IAGRC,OAAOC,SAASC,QAAQR,QAUzBtB"}