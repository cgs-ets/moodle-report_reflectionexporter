{"version":3,"file":"validate_pdf.min.js","sources":["../src/validate_pdf.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * Validate that the PDF provided is a form.\n * @package    report\n * @subpackage reflectionexporter\n * @copyright  2022 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'report_reflectionexporter/pdf-lib',\n    'report_reflectionexporter/reflectionexporter',\n    'core/url'\n\n\n], function (PDFLib, ReflectionExporter, URL) {\n    \"use strict\";\n\n    var ValidatePDF = function (data) {\n        this._isForm(data);\n    }\n\n\n    ValidatePDF.prototype._isForm = async function (data) {\n\n        const formPdfBytes = await fetch(data.fileurl).then((res) => res.arrayBuffer());\n        const pdfDoc = await PDFLib.PDFDocument.load(formPdfBytes);\n        const form = pdfDoc.getForm();\n        const fields = form.getFields();\n\n        if (fields.length == 0) {\n            // take the user back to t\n            const link = URL.relativeUrl('/report/reflectionexporter/index.php', {\n                cid: data.cid,\n                cmid: data.cmid,\n                rid: data.rid,\n                wf: 1,\n            });\n           \n            window.location.replace(link);\n            return;\n        } else {\n            ReflectionExporter.init(JSON.parse(document.querySelector('.importing-animation').getAttribute('data-info')))\n        }\n    }\n\n\n\n\n    return ValidatePDF;\n\n});"],"names":["define","PDFLib","ReflectionExporter","URL","ValidatePDF","data","_isForm","prototype","fetch","fileurl","then","res","arrayBuffer","formPdfBytes","PDFDocument","load","getForm","getFields","length","link","relativeUrl","cid","cmid","rid","wf","window","location","replace","init","JSON","parse","document","querySelector","getAttribute"],"mappings":";;;;;;;;;AAwBAA,gDAAO,CACH,oCACA,+CACA,aAGD,SAAUC,OAAQC,mBAAoBC,iBAGjCC,YAAc,SAAUC,WACnBC,QAAQD,cAIjBD,YAAYG,UAAUD,qCAAU,iBAAgBD,wJAEjBG,MAAMH,KAAKI,SAASC,MAAK,SAACC,YAAQA,IAAIC,+BAA3DC,2CACeZ,OAAOa,YAAYC,KAAKF,wBAIxB,iBAHDG,UACAC,YAETC,sCAEDC,KAAOhB,IAAIiB,YAAY,uCAAwC,CACjEC,IAAKhB,KAAKgB,IACVC,KAAMjB,KAAKiB,KACXC,IAAKlB,KAAKkB,IACVC,GAAI,IAGRC,OAAOC,SAASC,QAAQR,wCAGxBjB,mBAAmB0B,KAAKC,KAAKC,MAAMC,SAASC,cAAc,wBAAwBC,aAAa,4aAOhG7B"}