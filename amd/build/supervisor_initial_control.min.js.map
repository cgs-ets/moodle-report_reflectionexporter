{"version":3,"sources":["../src/supervisor_initial_control.js"],"names":["define","$","SupervisorInitialControl","data","self","prototype","main","initListeners","document","getElementById","addEventListener","e","target","find","each","index","option","groupid","value","teacher","querySelectorAll","teacherid","getAttribute","dEl","split","length","classList","remove","details","delete","updateTeacherSelectionJSON","add","bind","supervisorintials","sinput","console","log","id","si","updateTeacherInitial","jsoninput","JSON","parse","jsoninputcurrent","filter","input","stringify","push","forEach","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the report_reflectionexporter/create_control module\n *\n * @package   report_reflectionexporter\n * @category  output\n * @copyright 2022 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module report_reflectionexporter/controls\n */\ndefine(['jquery'], function ($) {\n    'use strict';\n\n    /**\n     * Initializes the controls.\n     */\n    function init(data) {\n\n        const control = new SupervisorInitialControl(data);\n        control.main();\n\n    }\n\n    // Constructor.\n    function SupervisorInitialControl(data) {\n\n        var self = this;\n        self.data = data;\n\n    }\n\n    SupervisorInitialControl.prototype.main = function () {\n        var self = this;\n        self.initListeners();\n    };\n\n    // Add event listener to the select \n    SupervisorInitialControl.prototype.initListeners = function () {\n        const self = this;\n\n        document.getElementById('id_coursegroups').addEventListener('change', (function (e) {\n            // Add selected teachers to the JSON.\n            $(e.target).find('option:selected').each(function (index, option) {\n                const groupid = option.value;\n\n                // look for the teacher in the group.\n                const teacher = document.querySelectorAll(`[id^= id_teacher_${groupid}]`)[0];\n                // Get the div that has the id fitem_id_teacher_groupid_techerid.\n                let teacherid = `fitem_${teacher.getAttribute('id')}`;\n                const dEl = document.getElementById(teacherid);\n                teacherid = teacherid.split('_');\n                teacherid = teacherid[teacherid.length - 1];\n\n                dEl.classList.remove('teacher-initial-field-hide');\n                const details = {\n                    groupid: groupid,\n                    teacherid: teacherid,\n                    delete: 0\n                };\n                self.updateTeacherSelectionJSON(details);\n                //self.updateStudentSelectionJSON(details);\n            });\n\n            // Control that the unselect elements are not part of the JSON. (Example: Selected all first and then unselect some)\n            $('#id_coursegroups option:not(:selected)').each(function (index, option) {\n                const groupid = option.value;\n                // look for the teacher in the group.\n                const teacher = document.querySelectorAll(`[id^= id_teacher_${groupid}]`)[0];\n                let teacherid = `fitem_${teacher.getAttribute('id')}`;\n                const dEl = document.getElementById(teacherid);\n                teacherid = teacherid.split('_');\n                teacherid = teacherid[teacherid.length - 1];\n                dEl.classList.add('teacher-initial-field-hide');\n                const details = {\n                    groupid: groupid,\n                    teacherid: teacherid,\n                    delete: 1\n                };\n                self.updateTeacherSelectionJSON(details);\n\n\n            })\n\n        }).bind(self));\n\n        // Add listener to the teachers initial inputs to pick up any changes done.\n        const supervisorintials = document.querySelectorAll(\"[id^= id_teacher_]\");\n        $(supervisorintials).each(function (index, sinput) {\n            sinput.addEventListener('change', function (e) {\n                let teacherid = e.target.getAttribute('id');\n                teacherid = teacherid.split('_');\n                teacherid = teacherid[teacherid.length - 1];\n                console.log(e.target.value)\n                const data = {\n                    id: teacherid,\n                    si: e.target.value\n                };\n                self.updateTeacherInitial(data);\n            });\n        }).bind(self);\n    }\n\n    SupervisorInitialControl.prototype.updateTeacherSelectionJSON = function (details) {\n        let jsoninput = JSON.parse(document.getElementById('id_groupselectionjsonaux').value);\n        let jsoninputcurrent = JSON.parse(document.getElementById('id_groupselectionjson').value);\n\n        if (details.delete == 1) {\n            // We already put some data inthe currentjson to get to this point\n            jsoninputcurrent = jsoninputcurrent.filter(function (input) {\n                if (input.groupid != details.groupid) return input;\n            }, details);\n            document.getElementById('id_groupselectionjson').value = JSON.stringify(jsoninputcurrent);\n        } else {\n\n            // check if its not already  there\n            if (jsoninputcurrent.find(input => input.groupid == details.groupid) == undefined) {\n\n                jsoninput = jsoninput.filter(function (input) {\n                    if (input.groupid == details.groupid) return input;\n                }, details);\n\n                jsoninputcurrent.push(jsoninput[0]);\n            }\n            document.getElementById('id_groupselectionjson').value = JSON.stringify(jsoninputcurrent);\n        }\n\n    }\n\n    SupervisorInitialControl.prototype.updateTeacherInitial = function (data) {\n        console.log(data);\n        let jsoninput = JSON.parse(document.getElementById('id_groupselectionjsonaux').value);\n        let jsoninputcurrent = JSON.parse(document.getElementById('id_groupselectionjson').value);\n\n        // We need to update both jsons\n        jsoninputcurrent.forEach(function (teacher) {\n            if (teacher.id == data.id) {\n                teacher.si = data.si;\n            }\n        }, data);\n\n        jsoninput.forEach(function (teacher) {\n            if (teacher.id == data.id) {\n                teacher.si = data.si;\n                \n            }\n        }, data);\n\n        document.getElementById('id_groupselectionjson').value = JSON.stringify(jsoninputcurrent);\n        document.getElementById('id_groupselectionjsonaux').value = JSON.stringify(jsoninput);\n\n    }\n\n\n    return {\n        init: init\n    };\n});"],"file":"supervisor_initial_control.min.js"}