{"version":3,"file":"tok_view.min.js","sources":["../src/tok_view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript to handle the PDF view\r\n *\r\n * @module     report_reflectionexporter/tok_view\r\n * @copyright  2023 Veronica Bermegui\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([\r\n    'core/templates',\r\n    'core/ajax',\r\n], function (Templates, Ajax) {\r\n    \"use strict\";\r\n\r\n    var TokView = function () {\r\n        var self = this;\r\n        Templates.render('report_reflectionexporter/loading', {}).done(function (html, js) {\r\n            // Update the page.\r\n            $('[data-region=\"pdf-comment-container\"]').fadeOut(\"fast\", function () {\r\n                Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\r\n                $('[data-region=\"pdf-comment-container\"]').fadeIn(\"fast\");\r\n\r\n            }.bind(this));\r\n\r\n            // document.getElementById('download').addEventListener('click', self._zipdownload);\r\n            self._enableDownloadAndSummary();\r\n\r\n\r\n        });\r\n\r\n    }\r\n\r\n\r\n    TokView.prototype._zipdownload = function (e) {\r\n        document.getElementById('zipform').submit();\r\n    }\r\n\r\n    TokView.prototype._enableDownloadAndSummary = function () {\r\n        const self = this;\r\n        document.getElementById('download').addEventListener('click', self._zipdownload);\r\n\r\n        // Only display if there are no processes.\r\n        let notprocess = document.querySelector('.importing-animation').getAttribute('data-notprocess');\r\n        notprocess = parseInt(notprocess, 10);\r\n        console.log(\"NOT PROCESS\");\r\n        console.log(notprocess);\r\n\r\n        if (notprocess > 0) {\r\n            document.getElementById('summary').classList.remove('btn-summary-hidden');\r\n            document.getElementById('summary').addEventListener('click', self._loadsummary);\r\n        }\r\n    }\r\n\r\n    TokView.prototype._loadsummary = function () {\r\n\r\n        Ajax.call([{\r\n            methodname: \"report_reflectionexporter_get_ommited\",\r\n            args: {\r\n                recordid: document.querySelector('[data-region=\"viewer-navigation-panel\"]').getAttribute('data-rid'),\r\n            },\r\n            done: function (response) {\r\n                console.log(response);\r\n                let context = {\r\n                    students: JSON.parse(response.context)\r\n                };\r\n                console.log(context);\r\n\r\n                Templates.render('report_reflectionexporter/students_table', context).done(function (html, js) {\r\n                    Templates.replaceNodeContents(document.querySelector('div.omitted-table'), html, js);\r\n                    var modal = document.getElementById(\"myModal\");\r\n                    var span = document.getElementsByClassName(\"close\")[0];\r\n                    modal.style.display = \"block\"\r\n                    span.onclick = function () {\r\n                        modal.style.display = \"none\";\r\n                    }\r\n\r\n                    // When the user clicks anywhere outside of the modal, close it.\r\n                    window.onclick = function (event) {\r\n                        if (event.target == modal) {\r\n                            modal.style.display = \"none\";\r\n                        }\r\n                    }\r\n                })\r\n\r\n\r\n            },\r\n            fail: function (reason) {\r\n                console.log(reason);\r\n            },\r\n        },]);\r\n    }\r\n\r\n    return TokView;\r\n\r\n});"],"names":["define","Templates","Ajax","TokView","self","this","render","done","html","js","$","fadeOut","replaceNodeContents","fadeIn","bind","_enableDownloadAndSummary","prototype","_zipdownload","e","document","getElementById","submit","addEventListener","notprocess","querySelector","getAttribute","parseInt","console","log","classList","remove","_loadsummary","call","methodname","args","recordid","response","context","students","JSON","parse","modal","span","getElementsByClassName","style","display","onclick","window","event","target","fail","reason"],"mappings":";;;;;;;AAuBAA,4CAAO,CACH,iBACA,cACD,SAAUC,UAAWC,UAGhBC,QAAU,eACNC,KAAOC,KACXJ,UAAUK,OAAO,oCAAqC,IAAIC,MAAK,SAAUC,KAAMC,IAE3EC,EAAE,yCAAyCC,QAAQ,OAAQ,WACvDV,UAAUW,oBAAoBF,EAAE,yCAA0CF,KAAMC,IAChFC,EAAE,yCAAyCG,OAAO,SAEpDC,KAAKT,OAGPD,KAAKW,uCAQbZ,QAAQa,UAAUC,aAAe,SAAUC,GACvCC,SAASC,eAAe,WAAWC,UAGvClB,QAAQa,UAAUD,0BAA4B,iBACpCX,KAAOC,KACbc,SAASC,eAAe,YAAYE,iBAAiB,QAASlB,KAAKa,kBAG/DM,WAAaJ,SAASK,cAAc,wBAAwBC,aAAa,mBAC7EF,WAAaG,SAASH,WAAY,IAClCI,QAAQC,IAAI,eACZD,QAAQC,IAAIL,YAERA,WAAa,IACbJ,SAASC,eAAe,WAAWS,UAAUC,OAAO,sBACpDX,SAASC,eAAe,WAAWE,iBAAiB,QAASlB,KAAK2B,gBAI1E5B,QAAQa,UAAUe,aAAe,WAE7B7B,KAAK8B,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,SAAUhB,SAASK,cAAc,2CAA2CC,aAAa,aAE7FlB,KAAM,SAAU6B,UACZT,QAAQC,IAAIQ,cACRC,QAAU,CACVC,SAAUC,KAAKC,MAAMJ,SAASC,UAElCV,QAAQC,IAAIS,SAEZpC,UAAUK,OAAO,2CAA4C+B,SAAS9B,MAAK,SAAUC,KAAMC,IACvFR,UAAUW,oBAAoBO,SAASK,cAAc,qBAAsBhB,KAAMC,QAC7EgC,MAAQtB,SAASC,eAAe,WAChCsB,KAAOvB,SAASwB,uBAAuB,SAAS,GACpDF,MAAMG,MAAMC,QAAU,QACtBH,KAAKI,QAAU,WACXL,MAAMG,MAAMC,QAAU,QAI1BE,OAAOD,QAAU,SAAUE,OACnBA,MAAMC,QAAUR,QAChBA,MAAMG,MAAMC,QAAU,aAOtCK,KAAM,SAAUC,QACZxB,QAAQC,IAAIuB,aAKjBhD"}