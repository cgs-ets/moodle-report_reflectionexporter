{"version":3,"file":"tok_view.min.js","sources":["../src/tok_view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to handle the PDF view\n *\n * @module     report_reflectionexporter/tok_view\n * @copyright  2023 Veronica Bermegui\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'core/templates',\n    'core/ajax',\n], function (Templates, Ajax) {\n    \"use strict\";\n\n    var TokView = function () {\n        var self = this;\n        Templates.render('report_reflectionexporter/loading', {}).done(function (html, js) {\n            // Update the page.\n            $('[data-region=\"pdf-comment-container\"]').fadeOut(\"fast\", function () {\n                Templates.replaceNodeContents($('[data-region=\"pdf-comment-container\"]'), html, js);\n                $('[data-region=\"pdf-comment-container\"]').fadeIn(\"fast\");\n\n            }.bind(this));\n\n            // document.getElementById('download').addEventListener('click', self._zipdownload);\n            self._enableDownloadAndSummary();\n\n\n        });\n\n    }\n\n\n    TokView.prototype._zipdownload = function (e) {\n        document.getElementById('zipform').submit();\n    }\n\n    TokView.prototype._enableDownloadAndSummary = function () {\n        const self = this;\n        document.getElementById('download').addEventListener('click', self._zipdownload);\n\n        // Only display if there are no processes.\n        let notprocess = document.querySelector('.importing-animation').getAttribute('data-notprocess');\n        notprocess = parseInt(notprocess, 10);\n        console.log(\"NOT PROCESS\");\n        console.log(notprocess);\n\n        if (notprocess > 0) {\n            document.getElementById('summary').classList.remove('btn-summary-hidden');\n            document.getElementById('summary').addEventListener('click', self._loadsummary);\n        }\n    }\n\n    TokView.prototype._loadsummary = function () {\n\n        Ajax.call([{\n            methodname: \"report_reflectionexporter_get_ommited\",\n            args: {\n                recordid: document.querySelector('[data-region=\"viewer-navigation-panel\"]').getAttribute('data-rid'),\n            },\n            done: function (response) {\n                console.log(response);\n                let context = {\n                    students: JSON.parse(response.context)\n                };\n                console.log(context);\n\n                Templates.render('report_reflectionexporter/students_table', context).done(function (html, js) {\n                    Templates.replaceNodeContents(document.querySelector('div.omitted-table'), html, js);\n                    var modal = document.getElementById(\"myModal\");\n                    var span = document.getElementsByClassName(\"close\")[0];\n                    modal.style.display = \"block\"\n                    span.onclick = function () {\n                        modal.style.display = \"none\";\n                    }\n\n                    // When the user clicks anywhere outside of the modal, close it.\n                    window.onclick = function (event) {\n                        if (event.target == modal) {\n                            modal.style.display = \"none\";\n                        }\n                    }\n                })\n\n\n            },\n            fail: function (reason) {\n                console.log(reason);\n            },\n        },]);\n    }\n\n    return TokView;\n\n});"],"names":["define","Templates","Ajax","TokView","self","this","render","done","html","js","$","fadeOut","replaceNodeContents","fadeIn","bind","_enableDownloadAndSummary","prototype","_zipdownload","e","document","getElementById","submit","addEventListener","notprocess","querySelector","getAttribute","parseInt","console","log","classList","remove","_loadsummary","call","methodname","args","recordid","response","context","students","JSON","parse","modal","span","getElementsByClassName","style","display","onclick","window","event","target","fail","reason"],"mappings":";;;;;;;AAuBAA,4CAAO,CACH,iBACA,cACD,SAAUC,UAAWC,UAGhBC,QAAU,eACNC,KAAOC,KACXJ,UAAUK,OAAO,oCAAqC,IAAIC,MAAK,SAAUC,KAAMC,IAE3EC,EAAE,yCAAyCC,QAAQ,OAAQ,WACvDV,UAAUW,oBAAoBF,EAAE,yCAA0CF,KAAMC,IAChFC,EAAE,yCAAyCG,OAAO,SAEpDC,KAAKT,OAGPD,KAAKW,uCAQbZ,QAAQa,UAAUC,aAAe,SAAUC,GACvCC,SAASC,eAAe,WAAWC,UAGvClB,QAAQa,UAAUD,0BAA4B,iBACpCX,KAAOC,KACbc,SAASC,eAAe,YAAYE,iBAAiB,QAASlB,KAAKa,kBAG/DM,WAAaJ,SAASK,cAAc,wBAAwBC,aAAa,mBAC7EF,WAAaG,SAASH,WAAY,IAClCI,QAAQC,IAAI,eACZD,QAAQC,IAAIL,YAERA,WAAa,IACbJ,SAASC,eAAe,WAAWS,UAAUC,OAAO,sBACpDX,SAASC,eAAe,WAAWE,iBAAiB,QAASlB,KAAK2B,gBAI1E5B,QAAQa,UAAUe,aAAe,WAE7B7B,KAAK8B,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,SAAUhB,SAASK,cAAc,2CAA2CC,aAAa,aAE7FlB,KAAM,SAAU6B,UACZT,QAAQC,IAAIQ,cACRC,QAAU,CACVC,SAAUC,KAAKC,MAAMJ,SAASC,UAElCV,QAAQC,IAAIS,SAEZpC,UAAUK,OAAO,2CAA4C+B,SAAS9B,MAAK,SAAUC,KAAMC,IACvFR,UAAUW,oBAAoBO,SAASK,cAAc,qBAAsBhB,KAAMC,QAC7EgC,MAAQtB,SAASC,eAAe,WAChCsB,KAAOvB,SAASwB,uBAAuB,SAAS,GACpDF,MAAMG,MAAMC,QAAU,QACtBH,KAAKI,QAAU,WACXL,MAAMG,MAAMC,QAAU,QAI1BE,OAAOD,QAAU,SAAUE,OACnBA,MAAMC,QAAUR,QAChBA,MAAMG,MAAMC,QAAU,aAOtCK,KAAM,SAAUC,QACZxB,QAAQC,IAAIuB,aAKjBhD"}